# RESCHEDULE_BOOKING Bug Fix Plan

**Last Updated:** 2025-11-28
**Version:** 2.0 (Updated after plan review)
**Review Grade:** 6/10 ‚Üí Target: 9/10

## Executive Summary

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥: AI —Å–æ–æ–±—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ–Ω–æ—Å–µ –∑–∞–ø–∏—Å–∏, –∫–æ–≥–¥–∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Å–ª–æ—Ç –∑–∞–Ω—è—Ç. –ö–ª–∏–µ–Ω—Ç –¥—É–º–∞–µ—Ç —á—Ç–æ –∑–∞–ø–∏—Å–∞–Ω –Ω–∞ 14:00, –Ω–æ –µ–≥–æ –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞–ª–∞—Å—å –Ω–∞ —Å—Ç–∞—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–ò–Ω—Ü–∏–¥–µ–Ω—Ç:** –í–ª–∞–¥–∏–º–∏—Ä –ø–æ–ø—Ä–æ—Å–∏–ª –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ 14:00, —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ —á—Ç–æ —Å–ª–æ—Ç –∑–∞–Ω—è—Ç –∏ –≤–µ—Ä–Ω—É–ª–∞ `success: false`, –Ω–æ AI –Ω–∞–ø–∏—Å–∞–ª "–ø–µ—Ä–µ–Ω–µ—Å –≤–∞—à—É –∑–∞–ø–∏—Å—å –Ω–∞ 14:00".

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–∏—Å—Ç–µ–º–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**Plan Review –≤—ã—è–≤–∏–ª:** –≠—Ç–æ –ù–ï –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–≥! **7 –∫–æ–º–∞–Ω–¥** –∏–º–µ—é—Ç —Ç—É –∂–µ –ø—Ä–æ–±–ª–µ–º—É (–Ω–µ—Ç case handler):
1. CONFIRM_BOOKING - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
2. MARK_NO_SHOW - –æ—Ç–º–µ—Ç–∫–∞ –Ω–µ—è–≤–∫–∏
3. **RESCHEDULE_BOOKING** ‚Üê —Ç–µ–∫—É—â–∏–π –±–∞–≥ (PRIORITY)
4. SAVE_CLIENT_NAME - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏
5. SHOWBOOKINGS - –ø–æ–∫–∞–∑ –∑–∞–ø–∏—Å–µ–π
6. SHOW_BOOKINGS - –ø–æ–∫–∞–∑ –∑–∞–ø–∏—Å–µ–π (–∞–ª–∏–∞—Å)
7. SHOW_PORTFOLIO - –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –º–∞—Å—Ç–µ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª—è–µ–º RESCHEDULE_BOOKING —Å–µ–π—á–∞—Å, —Å–æ–∑–¥–∞—ë–º follow-up –∑–∞–¥–∞—á—É –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.

## Root Cause Analysis

### –¶–µ–ø–æ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
rescheduleBooking() ‚Üí { success: false, slotNotAvailable: true, nearbySlots: [...] }
      ‚Üì
two-stage-processor.js ‚Üí { success: true, data: { success: false, ... } }  ‚Üê –ü–†–û–ë–õ–ï–ú–ê #1
      ‚Üì
formatCommandResults() ‚Üí switch(command) ‚Üí default: "‚úÖ RESCHEDULE_BOOKING: –í—ã–ø–æ–ª–Ω–µ–Ω–æ"  ‚Üê –ü–†–û–ë–õ–ï–ú–ê #2
      ‚Üì
Stage 2 AI ‚Üí "–ü–µ—Ä–µ–Ω–µ—Å –≤–∞—à—É –∑–∞–ø–∏—Å—å –Ω–∞ 14:00"  ‚Üê –õ–û–ñ–¨
```

### –ü—Ä–æ–±–ª–µ–º–∞ #1: two-stage-processor.js (—Å—Ç—Ä–æ–∫–∞ 312)
–í–Ω–µ—à–Ω–∏–π `success: true` –≤—Å–µ–≥–¥–∞, –∏–≥–Ω–æ—Ä–∏—Ä—É—è `data.success: false`

### –ü—Ä–æ–±–ª–µ–º–∞ #2: two-stage-response-prompt.js (—Å—Ç—Ä–æ–∫–∏ 49-219)
–ù–µ—Ç case –¥–ª—è `RESCHEDULE_BOOKING` –≤ switch - –ø–∞–¥–∞–µ—Ç –≤ default

## Implementation Plan

### Phase 1: Primary Fix (CRITICAL) - 30 min

**File:** `src/services/ai-admin-v2/prompts/two-stage-response-prompt.js`
**Location:** –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 215 (–ø–æ—Å–ª–µ case CHECK_STAFF_SCHEDULE, –ø–µ—Ä–µ–¥ default)

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π case handler –¥–ª—è RESCHEDULE_BOOKING —Å **–≤—Å–µ–º–∏ 8 —Ç–∏–ø–∞–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**:

```javascript
case 'RESCHEDULE_BOOKING':
  // –•–µ–ª–ø–µ—Ä –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
  const formatDT = (dt) => {
    if (!dt) return '–Ω–µ —É–∫–∞–∑–∞–Ω–æ';
    if (dt.includes('T')) {
      const [date, time] = dt.split('T');
      const [y, m, d] = date.split('-');
      return `${d}.${m}.${y} –≤ ${time.substring(0, 5)}`;
    }
    return dt;
  };

  // Case 1: –£—Å–ø–µ—à–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å
  if (data && data.success === true) {
    return `‚úÖ RESCHEDULE_BOOKING: –ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞
–ë—ã–ª–æ: ${formatDT(data.oldDateTime)}
–°—Ç–∞–ª–æ: ${formatDT(data.newDateTime)}
–£—Å–ª—É–≥–∞: ${data.services?.[0]?.title || data.services?.[0]?.service_title || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}
–ú–∞—Å—Ç–µ—Ä: ${data.staff?.name || '–Ω–µ —É–∫–∞–∑–∞–Ω'}`;
  }

  // Case 2: –°–ª–æ—Ç –∑–∞–Ω—è—Ç (–¢–ï–ö–£–©–ò–ô –ë–ê–ì)
  if (data && data.slotNotAvailable) {
    return `‚ùå RESCHEDULE_BOOKING: –í—Ä–µ–º—è ${data.requestedTime} –ó–ê–ù–Ø–¢–û
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: ${data.nearbySlots?.join(', ') || '–Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Ä—è–¥–æ–º'}
${data.message || ''}
${data.suggestions || ''}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ù–ï –≥–æ–≤–æ—Ä–∏ —á—Ç–æ –ø–µ—Ä–µ–Ω—ë—Å! –ü—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è!`;
  }

  // Case 3: –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (403)
  if (data && data.permissionError) {
    return `‚ùå RESCHEDULE_BOOKING: –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞
${data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞'}
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: ${data.alternativeAction === 'cancel_and_rebook' ? '–æ—Ç–º–µ–Ω–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é' : '–æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É'}

‚ö†Ô∏è –ü—Ä–µ–¥–ª–æ–∂–∏ –æ—Ç–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é!`;
  }

  // Case 4: –ù—É–∂–Ω–∞ –¥–∞—Ç–∞/–≤—Ä–µ–º—è
  if (data && data.needsDateTime) {
    const bookingsInfo = data.bookings?.length > 0
      ? `\n–¢–µ–∫—É—â–∏–µ –∑–∞–ø–∏—Å–∏: ${data.bookings.map(b => formatDT(b.datetime)).join(', ')}`
      : '';
    return `‚ö†Ô∏è RESCHEDULE_BOOKING: –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
${data.message || '–ù–∞ –∫–∞–∫—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏?'}${bookingsInfo}`;
  }

  // Case 5: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
  if (data && data.error && data.error.includes('–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π')) {
    return `‚ö†Ô∏è RESCHEDULE_BOOKING: –£ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
–°–æ–æ–±—â–∏ —á—Ç–æ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞`;
  }

  // Case 6: –ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
  if (data && data.error && data.error.includes('–Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–ø–∏—Å–µ–π')) {
    return `‚ö†Ô∏è RESCHEDULE_BOOKING: –ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
–í—Å–µ –∑–∞–ø–∏—Å–∏ –≤ –ø—Ä–æ—à–ª–æ–º –∏–ª–∏ –æ—Ç–º–µ–Ω–µ–Ω—ã`;
  }

  // Case 7-8: –û–±—â–∞—è –æ—à–∏–±–∫–∞ –∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
  const errorMsg = data?.error || error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞';
  return `‚ùå RESCHEDULE_BOOKING: –ü–µ—Ä–µ–Ω–æ—Å –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω
–ü—Ä–∏—á–∏–Ω–∞: ${errorMsg}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ù–ï –≥–æ–≤–æ—Ä–∏ –∫–ª–∏–µ–Ω—Ç—É —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª! –°–æ–æ–±—â–∏ –æ–± –æ—à–∏–±–∫–µ!`;
```

### Phase 2: Secondary Fix - ‚ùå –û–¢–ö–õ–û–ù–ï–ù–û

**–ü—Ä–∏—á–∏–Ω–∞:** Plan review –ø–æ–∫–∞–∑–∞–ª —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `two-stage-processor.js` **—Å–ª–æ–º–∞–µ—Ç 5 –∏–∑ 6** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥ (SEARCH_SLOTS, CREATE_BOOKING, SHOW_PRICES, EXPLAIN_SERVICE, CHECK_STAFF_SCHEDULE) - –æ–Ω–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω `success: true/false` –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –ø–æ–ª–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥.

### Phase 3: Add Prompt Templates

**File:** `src/services/ai-admin-v2/prompts/two-stage-response-prompt.js`
**Location:** –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ ~436 (—Å–µ–∫—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤)

–î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–ª—è RESCHEDULE:

```
üîÑ –ü–ï–†–ï–ù–û–° –ó–ê–ü–ò–°–ò:

‚ùå –í–†–ï–ú–Ø –ó–ê–ù–Ø–¢–û (slotNotAvailable: true):
"–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, [–≤—Ä–µ–º—è] —É–∂–µ –∑–∞–Ω—è—Ç–æ.
–ï—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è: [nearbySlots].
–ù–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –≤–∞—Å –∑–∞–ø–∏—Å–∞—Ç—å?"

‚úÖ –£–°–ü–ï–®–ù–´–ô –ü–ï–†–ï–ù–û–° (success: true):
"[–ò–º—è], –ø–µ—Ä–µ–Ω—ë—Å –≤–∞—à—É –∑–∞–ø–∏—Å—å —Å [—Å—Ç–∞—Ä–æ–µ –≤—Ä–µ–º—è] –Ω–∞ [–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è] –∫ [–º–∞—Å—Ç–µ—Ä].
–ñ–¥—ë–º –≤–∞—Å!"

‚ùå –û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê (permissionError):
"–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ –º–æ–≥—É –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.
–î–∞–≤–∞–π—Ç–µ –æ—Ç–º–µ–Ω—é —Å—Ç–∞—Ä—É—é –∏ —Å–æ–∑–¥–∞–º –Ω–æ–≤—É—é –Ω–∞ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è?"
```

## All Possible rescheduleBooking() Results

| –°–ª—É—á–∞–π | success | –§–ª–∞–≥–∏ | –ü–æ–ª—è data |
|--------|---------|-------|-----------|
| –£—Å–ø–µ—Ö | `true` | - | `oldDateTime`, `newDateTime`, `services`, `staff` |
| –°–ª–æ—Ç –∑–∞–Ω—è—Ç | `false` | `slotNotAvailable: true` | `requestedTime`, `nearbySlots`, `message`, `suggestions` |
| –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π | `false` | - | `error: '–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π'` |
| –ù–µ—Ç –±—É–¥—É—â–∏—Ö | `false` | - | `error: '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–ø–∏—Å–µ–π'` |
| –ù—É–∂–Ω–∞ –¥–∞—Ç–∞/–≤—Ä–µ–º—è | `false` | `needsDateTime: true` | `bookings`, `message` |
| –û—à–∏–±–∫–∞ 403 | `false` | `permissionError: true` | `error`, `alternativeAction` |
| –û–±—â–∞—è –æ—à–∏–±–∫–∞ | `false` | - | `error: string` |

## Test Scenarios

### –¢–µ—Å—Ç 1: –°–ª–æ—Ç –∑–∞–Ω—è—Ç (—Ç–µ–∫—É—â–∏–π –±–∞–≥)
```
Input: "–ü–µ—Ä–µ–Ω–µ—Å–∏ –Ω–∞ 14:00" (—Å–ª–æ—Ç –∑–∞–Ω—è—Ç)
Expected: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, 14:00 –∑–∞–Ω—è—Ç–æ. –ï—Å—Ç—å: 14:30, 15:00, 15:30"
NOT: "–ü–µ—Ä–µ–Ω—ë—Å –Ω–∞ 14:00"
```

### –¢–µ—Å—Ç 2: –£—Å–ø–µ—à–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å
```
Input: "–ü–µ—Ä–µ–Ω–µ—Å–∏ –Ω–∞ 15:00" (—Å–ª–æ—Ç —Å–≤–æ–±–æ–¥–µ–Ω)
Expected: "–ü–µ—Ä–µ–Ω—ë—Å –≤–∞—à—É –∑–∞–ø–∏—Å—å –Ω–∞ 15:00 –∫ –ë–∞—Ä–∏"
```

### –¢–µ—Å—Ç 3: –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π
```
Input: "–ü–µ—Ä–µ–Ω–µ—Å–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞" (–Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π)
Expected: "–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞"
```

## Files to Modify

1. **PRIMARY:** `src/services/ai-admin-v2/prompts/two-stage-response-prompt.js`
   - Add RESCHEDULE_BOOKING case (—Å—Ç—Ä–æ–∫–∞ ~216)
   - Add prompt templates (—Å—Ç—Ä–æ–∫–∞ ~436)

2. **SECONDARY:** `src/services/ai-admin-v2/modules/two-stage-processor.js`
   - Fix success flag logic (—Å—Ç—Ä–æ–∫–∏ 308-316)

## Risk Assessment

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –†–µ–≥—Ä–µ—Å—Å–∏—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–∞–Ω–¥ | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å CREATE_BOOKING, CANCEL_BOOKING |
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ 7 —Å–ª—É—á–∞–µ–≤ rescheduleBooking |
| Stage 2 –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –î–æ–±–∞–≤–∏—Ç—å "–ö–†–ò–¢–ò–ß–ù–û" –º–∞—Ä–∫–µ—Ä—ã |

## Deployment Plan

1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `node -c src/services/ai-admin-v2/prompts/two-stage-response-prompt.js`
3. Commit: `git add -A && git commit -m "fix: handle RESCHEDULE_BOOKING slotNotAvailable in formatCommandResults"`
4. Push: `git push origin main`
5. Deploy –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   ssh -i ~/.ssh/id_ed25519_ai_admin root@46.149.70.219 "cd /opt/ai-admin && git pull origin main && pm2 restart ai-admin-worker-v2"
   ```
6. –¢–µ—Å—Ç –Ω–∞ –Ω–æ–º–µ—Ä–µ 89686484488: –ø–æ–ø—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ –∑–∞–Ω—è—Ç–æ–µ –≤—Ä–µ–º—è
7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ 15 –º–∏–Ω—É—Ç

### Rollback Plan

```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:
ssh -i ~/.ssh/id_ed25519_ai_admin root@46.149.70.219
cd /opt/ai-admin
git log --oneline -3  # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–º–∏—Ç—ã
git revert HEAD       # –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
pm2 restart ai-admin-worker-v2
```

## Success Metrics

- [ ] –ü—Ä–∏ –∑–∞–Ω—è—Ç–æ–º —Å–ª–æ—Ç–µ AI –ù–ï –≥–æ–≤–æ—Ä–∏—Ç "–ø–µ—Ä–µ–Ω—ë—Å"
- [ ] AI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ª–æ—Ç—ã –∏–∑ nearbySlots
- [ ] –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ–Ω–æ—Å–µ AI –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ CREATE_BOOKING, CANCEL_BOOKING, SEARCH_SLOTS

## Phase 4: Client Communication - 5 min

**–£–≤–µ–¥–æ–º–∏—Ç—å –í–ª–∞–¥–∏–º–∏—Ä–∞** –æ–± –∞–∫—Ç—É–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏:

```
–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ +7 985 460-61-56:
"–í–ª–∞–¥–∏–º–∏—Ä, —É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–æ –∑–∞–ø–∏—Å–∏: –≤—ã –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ 29 –Ω–æ—è–±—Ä—è –≤ 14:30 –∫ –ë–∞—Ä–∏
(14:00 –±—ã–ª–æ –∑–∞–Ω—è—Ç–æ). –ñ–¥—ë–º –≤–∞—Å!"
```

## Phase 5: Follow-up Task

–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö 6 –∫–æ–º–∞–Ω–¥ –±–µ–∑ case handler:
- `dev/active/missing-command-handlers/`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: SHOW_BOOKINGS (–≤—ã—Å–æ–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫), CONFIRM_BOOKING
- –ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å: MARK_NO_SHOW, SHOW_PORTFOLIO (–Ω–∏–∑–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫)
