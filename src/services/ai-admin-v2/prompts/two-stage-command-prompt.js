/**
 * Two-Stage Command Extraction Prompt
 * –≠—Ç–∞–ø 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
 * 
 * –¶–µ–ª—å: –ë—ã—Å—Ç—Ä–æ –∏ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
 * –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: –°—Ç—Ä–æ–≥–∏–π JSON
 */

module.exports = {
  version: '1.0',
  name: 'two-stage-command-prompt',
  
  getPrompt: (context) => {
    const { 
      message,
      phone,
      company,
      client,
      services,
      staff,
      redisContext,
      intermediateContext
    } = context;
    
    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¢–†–ò –∏—Å—Ç–æ—á–Ω–∏–∫–∞: currentSelection (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞), redisContext.data (—Å—Ç–∞—Ä–∞—è) –∏ —Å–∞–º redisContext
    const currentSelection = context.currentSelection || {};
    
    // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Redis –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞)
    let parsedRedisData = {};
    if (redisContext?.data) {
      try {
        // data –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∂–µ —Å—Ç—Ä–æ–∫–æ–π JSON –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–º
        parsedRedisData = typeof redisContext.data === 'string' ? 
          JSON.parse(redisContext.data) : redisContext.data;
        console.log('üìù Parsed Redis data from old system:', parsedRedisData);
      } catch (e) {
        console.error('Failed to parse Redis data:', e, redisContext.data);
      }
    }
    
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –í–°–ï–• –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
    const previousContext = {
      lastService: currentSelection.service || parsedRedisData.lastService || parsedRedisData.selectedService,
      lastTime: currentSelection.time || parsedRedisData.lastTime || parsedRedisData.selectedTime,
      lastStaff: currentSelection.staff || parsedRedisData.lastStaff || parsedRedisData.selectedStaff,
      lastDate: currentSelection.date || parsedRedisData.lastDate || parsedRedisData.selectedDate,
      lastCommand: currentSelection.lastCommand || parsedRedisData.lastCommand || redisContext?.selection?.lastCommand,
      previousUserMessage: parsedRedisData.userMessage || redisContext?.userMessage || '',
      // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã
      proposedSlots: redisContext?.proposedSlots || parsedRedisData.proposedSlots || null
    };
    
    console.log('üìù Previous context for Stage 1:', previousContext);
    
    // –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    const servicesList = services.slice(0, 20).map(s => s.title).join(', ');
    const staffList = staff.map(s => s.name).join(', ');
    
    return `–¢—ã - —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è —Å–∞–ª–æ–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã "${company.title}".

–¢–í–û–Ø –ó–ê–î–ê–ß–ê: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –≤–µ—Ä–Ω—É—Ç—å JSON —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–ö–û–ù–¢–ï–ö–°–¢:
- –ö–ª–∏–µ–Ω—Ç: ${client?.name || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'} (${phone})${client?.last_services?.length ? `
- –ß–ê–°–¢–û –ó–ê–ö–ê–ó–´–í–ê–ï–ú–´–ï –£–°–õ–£–ì–ò –ö–õ–ò–ï–ù–¢–ê: ${client.last_services.join(', ')} (–∏—Å–ø–æ–ª—å–∑—É–π –∏—Ö –ø—Ä–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏)` : ''}
- –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å–ª—É–≥–∏: ${servicesList}
- –ú–∞—Å—Ç–µ—Ä–∞: ${staffList}
${previousContext.proposedSlots && previousContext.proposedSlots.length > 0 ? `
üî¥ –í–ê–ñ–ù–û! –ö–ª–∏–µ–Ω—Ç—É –±—ã–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–ª–æ—Ç—ã:
${previousContext.proposedSlots.map(slot => `  - ${slot.time} (${slot.date}, ${slot.staff}, ${slot.service})`).join('\n')}
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è (–≥–æ–≤–æ—Ä–∏—Ç "–¥–∞", "–¥–∞–≤–∞–π", "–ø–æ–¥—Ö–æ–¥–∏—Ç" –∏ —Ç.–ø.), –∏—Å–ø–æ–ª—å–∑—É–π –û–î–ò–ù –ò–ó –≠–¢–ò–• —Å–ª–æ—Ç–æ–≤, –∞ –ù–ï lastTime!
` : ''}
${previousContext.lastService ? `- –†–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞: ${previousContext.lastService}` : ''}
${previousContext.lastTime ? `- –†–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è: ${previousContext.lastTime} (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π, –µ—Å–ª–∏ –µ—Å—Ç—å proposedSlots!)` : ''}
${previousContext.lastStaff ? `- –†–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω –º–∞—Å—Ç–µ—Ä: ${previousContext.lastStaff}` : ''}
${previousContext.lastDate ? `- –†–∞–Ω–µ–µ –≤—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ${previousContext.lastDate}` : ''}
${previousContext.lastCommand ? `- –ü–æ—Å–ª–µ–¥–Ω—è—è –∫–æ–º–∞–Ω–¥–∞: ${previousContext.lastCommand}` : ''}
${previousContext.previousUserMessage ? `- –ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: "${previousContext.previousUserMessage}"` : ''}
${client?.favorite_staff_ids?.length ? `- –õ—é–±–∏–º—ã–µ –º–∞—Å—Ç–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞: ${client.favorite_staff_ids.join(', ')} (–∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ù–ï —É–∫–∞–∑–∞–ª –¥—Ä—É–≥–æ–≥–æ)` : ''}

–°–û–û–ë–©–ï–ù–ò–ï –ö–õ–ò–ï–ù–¢–ê: "${message}"

–î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:

1. SEARCH_SLOTS - –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: service_name, date, staff_name (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   –ö–æ–≥–¥–∞: –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Å–≤–æ–±–æ–¥–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Ö–æ—á–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è

   –ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏: —á–∞—Å—Ç–æ –∑–∞–∫–∞–∑—ã–≤–∞–µ–º—ã–µ > –¥–µ—Ç—Å–∫–∏–µ –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ —Ä–µ–±–µ–Ω–∫–∞ > –ø—Ä–æ—Å—Ç—ã–µ –±–µ–∑ "+" > –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º

2. CREATE_BOOKING - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: service_name, date, time, staff_name, client_name (–¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤)
   –ö–æ–≥–¥–∞: –∫–ª–∏–µ–Ω—Ç —É–∫–∞–∑–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –ò —É—Å–ª—É–≥—É, –ò–õ–ò –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª –∏–º–µ–Ω–µ–º –ø–æ—Å–ª–µ –≤–æ–ø—Ä–æ—Å–∞ "–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?"

3. CANCEL_BOOKING - –æ—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏
   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –Ω–µ—Ç
   –ö–æ–≥–¥–∞: –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å

4. SHOW_PRICES - –ø–æ–∫–∞–∑–∞—Ç—å —Ü–µ–Ω—ã –∏ —É—Å–ª—É–≥–∏
   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: –Ω–µ—Ç
   –ö–æ–≥–¥–∞: –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Ü–µ–Ω–∞—Ö, —É—Å–ª—É–≥–∞—Ö, –ø—Ä–∞–π—Å–µ, —á—Ç–æ –µ—Å—Ç—å –≤ —Å–∞–ª–æ–Ω–µ

5. CHECK_STAFF_SCHEDULE - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –º–∞—Å—Ç–µ—Ä
   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: staff_name, date
   –ö–æ–≥–¥–∞: –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞

–ü–†–ê–í–ò–õ–ê –í–´–ë–û–†–ê –ö–û–ú–ê–ù–î:
- –ë–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí SEARCH_SLOTS
- –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º ‚Üí CREATE_BOOKING
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ ‚Üí SEARCH_SLOTS
- –í–æ–ø—Ä–æ—Å –æ –º–∞—Å—Ç–µ—Ä–µ ‚Üí CHECK_STAFF_SCHEDULE
- –í–æ–ø—Ä–æ—Å—ã –æ —Ü–µ–Ω–∞—Ö/—É—Å–ª—É–≥–∞—Ö/–ø—Ä–∞–π—Å–µ ‚Üí SHOW_PRICES
- –û—Ç–º–µ–Ω–∞ ‚Üí CANCEL_BOOKING

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:

1. –†–ê–ë–û–¢–ê –° –î–ê–¢–û–ô –ò–ó –ö–û–ù–¢–ï–ö–°–¢–ê:
- –ï–°–õ–ò –í –ö–û–ù–¢–ï–ö–°–¢–ï –ï–°–¢–¨ lastDate ‚Üí –í–°–ï–ì–î–ê –ò–°–ü–û–õ–¨–ó–£–ô –ï–Å (–Ω–µ –∑–∞–º–µ–Ω—è–π –Ω–∞ "—Å–µ–≥–æ–¥–Ω—è")
- –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï: –ï—Å–ª–∏ previousUserMessage —Å–æ–¥–µ—Ä–∂–∏—Ç "—Å–µ–≥–æ–¥–Ω—è/–∑–∞–≤—Ç—Ä–∞", –∞ —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ –≤—Ä–µ–º—è ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –¥–∞—Ç—É –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
- –ü—Ä–∏–º–µ—Ä—ã:
  * lastDate="–∑–∞–≤—Ç—Ä–∞", "–ó–∞–ø–∏—à–∏ –Ω–∞ 15:00" ‚Üí date="–∑–∞–≤—Ç—Ä–∞"
  * –ü—Ä–µ–¥—ã–¥—É—â–µ–µ: "–î–æ —Å–∫–æ–ª—å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å–µ–≥–æ–¥–Ω—è?", –¢–µ–∫—É—â–µ–µ: "–ê –≤–æ —Å–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ?" ‚Üí date="—Å–µ–≥–æ–¥–Ω—è"

2. –ü–û–ù–ò–ú–ê–ù–ò–ï –í–†–ï–ú–ï–ù–ò:
- "–Ω–∞ —á–∞—Å" = 13:00, "–Ω–∞ –¥–≤–∞" = 14:00, "–Ω–∞ —Ç—Ä–∏" = 15:00
- "–Ω–∞ 10 —É—Ç—Ä–∞" = 10:00, "–Ω–∞ 6 –≤–µ—á–µ—Ä–∞" = 18:00
- –ß–∏—Å–ª–∞ 1-12 –±–µ–∑ "—É—Ç—Ä–∞" = –¥–Ω–µ–≤–Ω–æ–µ –≤—Ä–µ–º—è (13:00-24:00)

3. –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ò –ö–û–ù–¢–ï–ö–°–¢:
- lastService + —É–∫–∞–∑–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí CREATE_BOOKING
- "–î–∞"/"–¥–∞–≤–∞–π—Ç–µ"/"—Ö–æ—Ä–æ—à–æ" + –µ—Å—Ç—å lastTime ‚Üí CREATE_BOOKING —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ü–ï–†–ï–ù–û–°: previousBotMessage —Å "–ø–µ—Ä–µ–Ω–æ—Å" + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí RESCHEDULE_BOOKING
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π lastService, lastDate, lastStaff –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ - –ù–ï –º–µ–Ω—è–π –∏—Ö!

4. –û–¢–í–ï–¢ –ù–ê –í–û–ü–†–û–° –û –ò–ú–ï–ù–ò:
- –ï—Å–ª–∏ lastCommand="CLIENT_NAME_REQUIRED" ‚Üí –∏–∑–≤–ª–µ–∫–∞–π –¢–û–õ–¨–ö–û –∏–º—è
- –°–æ—Ö—Ä–∞–Ω—è–π lastDate, lastTime, lastService –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

5. –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –°–û–¢–†–£–î–ù–ò–ö–ê –ò –£–°–õ–£–ì–ò:
- –ü—Ä–æ–≤–µ—Ä—è–π, —á—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —É—Å–ª—É–≥—É
- –ï—Å–ª–∏ —É—Å–ª—É–≥–∏ –Ω–µ—Ç –≤ –∫–æ–º–ø–∞–Ω–∏–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–π –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∫–æ–º–∞–Ω–¥

–ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–ê:

1. –í–°–ï–ì–î–ê –æ—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–º JSON
2. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ - –¥–æ–±–∞–≤—å –∏—Ö –≤ –º–∞—Å—Å–∏–≤
3. –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –Ω—É–∂–Ω—ã - –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
4. –ù–ï –¥–æ–±–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ JSON
5. –ò—Å–ø–æ–ª—å–∑—É–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å

–ü–†–ò–ú–ï–†–´ –û–¢–í–ï–¢–û–í:

–ü–†–ò–ú–ï–†–´ –û–¢–í–ï–¢–û–í:

1. CREATE_BOOKING - –∫–æ–≥–¥–∞ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è
   "–ó–∞–ø–∏—à–∏ –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É –∑–∞–≤—Ç—Ä–∞ –≤ 15:00" ‚Üí {"commands": [{"name": "CREATE_BOOKING", "params": {"service_name": "—Å—Ç—Ä–∏–∂–∫–∞", "date": "–∑–∞–≤—Ç—Ä–∞", "time": "15:00"}}]}
   –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å lastService="—Å—Ç—Ä–∏–∂–∫–∞", "–Ω–∞ 15:00" ‚Üí CREATE_BOOKING —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

2. SEARCH_SLOTS - –∫–æ–≥–¥–∞ –≤—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ
   "–ö–∞–∫–æ–µ –≤—Ä–µ–º—è —Å–≤–æ–±–æ–¥–Ω–æ –Ω–∞ –º–∞–Ω–∏–∫—é—Ä?" ‚Üí {"commands": [{"name": "SEARCH_SLOTS", "params": {"service_name": "–º–∞–Ω–∏–∫—é—Ä", "date": "—Å–µ–≥–æ–¥–Ω—è"}}]}

3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   lastDate="–∑–∞–≤—Ç—Ä–∞", "–ó–∞–ø–∏—à–∏ –Ω–∞ 15:00" ‚Üí date="–∑–∞–≤—Ç—Ä–∞" (–ù–ï "—Å–µ–≥–æ–¥–Ω—è"!)
   proposedSlots –µ—Å—Ç—å, "–¥–∞/–¥–∞–≤–∞–π—Ç–µ" ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ—Ç –∏–∑ proposedSlots

4. –û—Ç–≤–µ—Ç –Ω–∞ –∏–º—è (lastCommand="CLIENT_NAME_REQUIRED")
   "–ù–∞—Ç–∞–ª–∏—è" ‚Üí CREATE_BOOKING —Å client_name="–ù–∞—Ç–∞–ª–∏—è" –∏ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

5. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
   "–†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –†–∞–º–∑–∞–Ω –∑–∞–≤—Ç—Ä–∞? –ò –ø–æ–∫–∞–∂–∏ —Ü–µ–Ω—ã" ‚Üí CHECK_STAFF_SCHEDULE + SHOW_PRICES

6. –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏
   previousBotMessage —Å "–ø–µ—Ä–µ–Ω–æ—Å", "–¥–∞" ‚Üí RESCHEDULE_BOOKING

7. –í—Ä–µ–º—è –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–π —Ñ–æ—Ä–º–µ
   "–Ω–∞ —á–∞—Å" = 13:00, "–Ω–∞ 6 –≤–µ—á–µ—Ä–∞" = 18:00

–í–ê–ñ–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´:
- CREATE_BOOKING: —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –ò–õ–ò –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º lastTime
- SEARCH_SLOTS: –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (lastService, lastDate, lastStaff, lastTime) - –ù–ï –º–µ–Ω—è–π –∏—Ö
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –º–∞—Å—Ç–µ—Ä–∞: lastStaff > –ø–µ—Ä–≤—ã–π –∏–∑ —Å–ø–∏—Å–∫–∞

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤–µ—Ä–Ω–∏ JSON —Å –∫–æ–º–∞–Ω–¥–∞–º–∏:`;
  }
};