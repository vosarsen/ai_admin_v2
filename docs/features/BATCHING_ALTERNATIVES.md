# Альтернативы Redis батчингу

## Проблема
Redis батчинг не работает стабильно из-за:
1. Разные процессы (API и batch processor) видят разные данные
2. Ключи исчезают преждевременно
3. TTL не соблюдается должным образом

## Альтернативные решения

### 1. Отключить батчинг (рекомендуется)
- Вернуться к прямой обработке через webhook `/webhook/whatsapp`
- Простое и надежное решение
- Минус: больше нагрузка на AI при rapid-fire сообщениях

### 2. In-memory батчинг
- Хранить батчи в памяти процесса API
- Использовать setTimeout для обработки
- Минус: батчи теряются при рестарте

### 3. Использовать BullMQ для батчинга
- BullMQ уже используется для очередей
- Можно создать специальную очередь для батчей
- Плюс: надежная обработка и персистентность

### 4. Исправить текущую реализацию
- Использовать Redis pub/sub для синхронизации
- Или использовать одну базу данных Redis для всех
- Требует глубокой отладки

## Рекомендация
Временно отключить батчинг и вернуться к прямой обработке. Это обеспечит стабильную работу бота для пользователей.