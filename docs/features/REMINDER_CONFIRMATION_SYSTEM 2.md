# üì± –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
- [API Reference](#api-reference)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [Troubleshooting](#troubleshooting)

## üéØ –û–±–∑–æ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–ø–∏—Å—è—Ö –∫–ª–∏–µ–Ω—Ç—ã —á–∞—Å—Ç–æ –æ—Ç–≤–µ—á–∞—é—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏ ("–æ–∫", "—Å–ø–∞—Å–∏–±–æ", "–±—É–¥—É"). –†–∞–Ω–µ–µ —Å–∏—Å—Ç–µ–º–∞ AI Admin –Ω–µ –ø–æ–Ω–∏–º–∞–ª–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç —ç—Ç–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏ –Ω–∞—á–∏–Ω–∞–ª–∞ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ —Å –≤–æ–ø—Ä–æ—Å–æ–º "–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?", —á—Ç–æ —Ä–∞–∑–¥—Ä–∞–∂–∞–ª–æ –∫–ª–∏–µ–Ω—Ç–æ–≤.

### –†–µ—à–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. **–†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç** –æ—Ç–≤–µ—Ç—ã –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
2. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç** –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (—Ä–µ–∞–∫—Ü–∏—è ‚ù§Ô∏è)
3. **–û–±–Ω–æ–≤–ª—è–µ—Ç** —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏ –≤ YClients –Ω–∞ "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω" (attendance=2)
4. **–ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç** AI –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è —Ç–∞–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ AI
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TD
    A[Booking Monitor] -->|–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ| B[WhatsApp Client]
    A -->|–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç| C[Redis: reminder_context]
    
    D[–ö–ª–∏–µ–Ω—Ç] -->|–û—Ç–≤–µ—á–∞–µ—Ç –æ–∫/—Å–ø–∞—Å–∏–±–æ| E[Webhook]
    E --> F[Message Worker v2]
    
    F -->|–ü—Ä–æ–≤–µ—Ä—è–µ—Ç| G[ReminderContextTracker]
    G -->|–ß–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç| C
    
    G -->|–ï—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ| H[–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π]
    H -->|1. –†–µ–∞–∫—Ü–∏—è ‚ù§Ô∏è| B
    H -->|2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å| I[YClients API]
    H -->|3. –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç| C
    
    G -->|–ï—Å–ª–∏ –ù–ï –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ| J[AI Admin v2]
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. ReminderContextTracker
**–ü—É—Ç—å**: `src/services/reminder/reminder-context-tracker.js`

–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.

#### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
- `saveReminderContext(phone, bookingData, reminderType)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `getReminderContext(phone)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `shouldHandleAsReminderResponse(phone, message)` - –ø—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–º
- `markAsConfirmed(phone)` - –ø–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–µ
- `isConfirmationMessage(message)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Booking Monitor
**–ü—É—Ç—å**: `src/services/booking-monitor/index.js`

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:
```javascript
await reminderContextTracker.saveReminderContext(phone, {
  record_id: record.id,
  datetime: record.datetime,
  service_name: services,
  staff_name: staff
}, reminderType);
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ Message Worker
**–ü—É—Ç—å**: `src/workers/message-worker-v2.js`

–ü–µ—Ä–µ—Ö–≤–∞—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –¥–æ AI:
```javascript
if (await reminderContextTracker.shouldHandleAsReminderResponse(from, message)) {
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
  await whatsappClient.sendReaction(from, '‚ù§Ô∏è');
  
  // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ YClients
  await yclientsClient.updateBookingStatus(recordId, 2);
  
  // –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–µ
  await reminderContextTracker.markAsConfirmed(from);
  
  return; // –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ AI
}
```

### 4. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è API

#### WhatsApp Client
**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥**: `sendReaction(phone, emoji)`
```javascript
// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
await whatsappClient.sendReaction('79001234567', '‚ù§Ô∏è');
```

#### YClients Client  
**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥**: `updateBookingStatus(recordId, attendance)`
```javascript
// –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏
// attendance: 2=–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, 1=–ø—Ä–∏—à–µ–ª, 0=–æ–∂–∏–¥–∞–Ω–∏–µ, -1=–Ω–µ –ø—Ä–∏—à–µ–ª
await yclientsClient.updateBookingStatus(123456, 2);
```

## üìö API Reference

### ReminderContextTracker API

#### saveReminderContext
```javascript
/**
 * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
 * @param {string} phone - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–±–µ–∑ @c.us)
 * @param {Object} bookingData - –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
 * @param {string} reminderType - –¢–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è ('day_before'|'2hours')
 * @returns {Promise<boolean>} - –£—Å–ø–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–∏
 */
await reminderContextTracker.saveReminderContext(
  '79001234567',
  {
    record_id: 123456,
    datetime: '2025-08-30T15:00:00',
    service_name: '–°—Ç—Ä–∏–∂–∫–∞',
    staff_name: '–ú–∞—Å—Ç–µ—Ä –ò–≤–∞–Ω'
  },
  'day_before'
);
```

#### shouldHandleAsReminderResponse
```javascript
/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
 * @param {string} phone - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
 * @param {string} message - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
 * @returns {Promise<boolean>} - true –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
 */
const isConfirmation = await reminderContextTracker.shouldHandleAsReminderResponse(
  '79001234567',
  '–û–∫, —Å–ø–∞—Å–∏–±–æ!'
);
```

### Redis —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```json
{
  "key": "reminder_context:79001234567",
  "ttl": 86400,
  "value": {
    "type": "day_before",
    "sentAt": "2025-08-29T15:00:00.000Z",
    "booking": {
      "recordId": 123456,
      "datetime": "2025-08-30T15:00:00.000Z",
      "serviceName": "–°—Ç—Ä–∏–∂–∫–∞",
      "staffName": "–ú–∞—Å—Ç–µ—Ä –ò–≤–∞–Ω"
    },
    "awaitingConfirmation": true,
    "confirmedAt": null
  }
}
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
REDIS_URL=redis://default:password@localhost:6379/0

# YClients API
YCLIENTS_API_KEY=your_api_key
YCLIENTS_USER_TOKEN=your_user_token
YCLIENTS_COMPANY_ID=962302

# WhatsApp
WHATSAPP_PROVIDER=venom
VENOM_BOT_URL=http://localhost:3001
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∏—Å—Ç–µ–º—ã
```javascript
// src/services/reminder/reminder-context-tracker.js
class ReminderContextTracker {
  constructor() {
    this.ttl = 24 * 60 * 60; // TTL –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ Redis (24 —á–∞—Å–∞)
    this.confirmationWindow = 30; // –û–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (30 –º–∏–Ω—É—Ç)
    this.staleThreshold = 12; // –ü–æ—Ä–æ–≥ —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏—è (12 —á–∞—Å–æ–≤)
  }
}
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

#### –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
- –æ–∫, ok
- –¥–∞, yes  
- —Ö–æ—Ä–æ—à–æ
- –∫–æ–Ω–µ—á–Ω–æ
- –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å

#### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏—è
- –±—É–¥—É, –±—É–¥–µ–º
- –ø—Ä–∏–¥—É, –ø—Ä–∏–¥–µ–º
- –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é
- —Å–æ–≥–ª–∞—Å–µ–Ω, —Å–æ–≥–ª–∞—Å–Ω–∞

#### –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
- —Å–ø–∞—Å–∏–±–æ
- –±–ª–∞–≥–æ–¥–∞—Ä—é

#### –≠–º–æ–¥–∑–∏
- üëç, üëå, ‚úÖ, üíØ
- +, ++

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞

1. **–û–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**: 30 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
2. **TTL –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: 24 —á–∞—Å–∞ (–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —É–¥–∞–ª—è–µ—Ç—Å—è)
3. **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è**: 12 —á–∞—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ª–æ–≥–æ–≤

#### –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
```
–ë–æ—Ç: üìÖ –ù–∞–ø–æ–º–∏–Ω–∞–µ–º! –ó–∞–≤—Ç—Ä–∞ –≤ 15:00 –≤–∞—Å –∂–¥–µ—Ç –º–∞—Å—Ç–µ—Ä –ò–≤–∞–Ω –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É
–ö–ª–∏–µ–Ω—Ç: –û–∫
–ë–æ—Ç: ‚ù§Ô∏è
[–°—Ç–∞—Ç—É—Å –≤ YClients –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"]
```

#### –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
```
–ë–æ—Ç: üìÖ –ù–∞–ø–æ–º–∏–Ω–∞–µ–º! –ó–∞–≤—Ç—Ä–∞ –≤ 15:00 –≤–∞—Å –∂–¥–µ—Ç –º–∞—Å—Ç–µ—Ä –ò–≤–∞–Ω –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É
–ö–ª–∏–µ–Ω—Ç: –ê –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ 16:00?
–ë–æ—Ç: –ö–æ–Ω–µ—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è...
[–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—ã—á–Ω–∞—è AI –æ–±—Ä–∞–±–æ—Ç–∫–∞]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

#### –õ–æ–∫–∞–ª—å–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç SSH —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è Redis)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å SSH —Ç—É–Ω–Ω–µ–ª—å
./scripts/maintain-redis-tunnel.sh start

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
node test-reminder-confirmation.js
```

#### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
./test-reminder-on-server.sh
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

1. **–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è –∏–∑ Redis
2. **–¢–µ—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** - 15 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. **–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
4. **–¢–µ—Å—Ç webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - end-to-end —Ç–µ—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```
‚úÖ saveContext: PASSED
‚úÖ detection: PASSED  
‚úÖ handling: PASSED
‚è≠Ô∏è webhook: SKIPPED (—Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π API)
```

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Redis
2. –ü—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 30 –º–∏–Ω—É—Ç —Å –º–æ–º–µ–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
3. –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –∫–æ–Ω—Ç–µ–∫—Å—Ç
redis-cli get "reminder_context:79001234567"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs ai-admin-worker-v2 --lines 100 | grep "reminder"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –†–µ–∞–∫—Ü–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. WhatsApp –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
2. Venom bot –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ)

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Venom bot
pm2 status venom-bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ WhatsApp –∫–ª–∏–µ–Ω—Ç–∞
pm2 logs ai-admin-worker-v2 | grep "sendReaction"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç—É—Å –≤ YClients –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–≤–µ—Ä–Ω—ã–π record_id
2. –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
3. YClients API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
pm2 logs ai-admin-worker-v2 | grep "updateBookingStatus"

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –Ω–∞–ø—Ä—è–º—É—é
curl -X PUT "https://api.yclients.com/api/v1/record/{company_id}/{record_id}" \
  -H "Authorization: Bearer {token}" \
  -d '{"attendance": 2}'
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—ç–∫–æ–Ω–æ–º–ª–µ–Ω–Ω—ã—Ö AI –≤—ã–∑–æ–≤–æ–≤

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
- `üìù` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- `‚úÖ` - —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- `‚ù§Ô∏è` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏
- `üîÑ` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ PM2
```bash
# –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å
pm2 status

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs ai-admin-worker-v2 --lines 100

# –ú–µ—Ç—Ä–∏–∫–∏
pm2 monit
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Checklist –¥–ª—è production
- [ ] Redis –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] SSH —Ç—É–Ω–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∫–ª—é—á–µ–Ω

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin feature/redis-context-cache

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
pm2 restart ai-admin-worker-v2
pm2 restart ai-admin-booking-monitor

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs --lines 50
```

## üìù Changelog

### v1.0.0 (29.08.2025)
- –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 15+ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YClients API
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ –≤ WhatsApp
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

## üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ PM2
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏