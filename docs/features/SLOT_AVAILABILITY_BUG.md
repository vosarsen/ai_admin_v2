# Баг с доступностью слотов YClients API

## Проблема

YClients API возвращает некорректные доступные слоты для длинных услуг.

### Пример конкретной ситуации:

**Услуга**: СТРИЖКА + МОДЕЛИРОВАНИЕ БОРОДЫ | LUXINA
- Длительность: 7800 секунд (130 минут = 2 часа 10 минут)

**Расписание мастера Бари на 21.08.2025**:
- 10:00-11:30 - ЗАНЯТО (Евгений, СТРИЖКА + МОДЕЛИРОВАНИЕ БОРОДЫ)
- 11:30-12:00 - СВОБОДНО (30 минут)
- 12:00-13:00 - ЗАНЯТО (Владимир, МУЖСКАЯ СТРИЖКА)
- 14:00-15:00 - ЗАНЯТО (Михаил, МУЖСКАЯ СТРИЖКА)
- 15:00-20:00 - СВОБОДНО

**API возвращает слоты**:
- 11:30 ❌ - НЕ ПОДХОДИТ (только 30 минут до следующей записи, а нужно 130)
- 12:00 ❌ - НЕ ПОДХОДИТ (время уже занято)
- 15:00 ✅ - ПОДХОДИТ
- 15:30 ✅ - ПОДХОДИТ
- и т.д.

## Причина

YClients API при вызове `/book_times` возвращает ВСЕ теоретически возможные точки начала услуги, не проверяя:
1. Достаточно ли времени до следующей записи
2. Не перекрывается ли слот с существующими записями

## Решение

Нужно добавить валидацию после получения слотов:

```javascript
function validateSlots(slots, serviceDuration, existingBookings) {
  return slots.filter(slot => {
    const slotStart = new Date(slot.datetime);
    const slotEnd = new Date(slotStart.getTime() + serviceDuration * 1000);
    
    // Проверка 1: Достаточно ли времени до следующей записи
    const nextBooking = findNextBooking(existingBookings, slotStart);
    if (nextBooking && slotEnd > nextBooking.start) {
      return false; // Слот перекрывается со следующей записью
    }
    
    // Проверка 2: Не начинается ли слот во время существующей записи
    const overlappingBooking = findOverlappingBooking(existingBookings, slotStart);
    if (overlappingBooking) {
      return false; // Слот начинается во время другой записи
    }
    
    return true;
  });
}
```

## Временное решение

Пока не реализована полная валидация, можно:
1. Запрашивать расписание мастера на день
2. Фильтровать слоты на основе реального расписания
3. Показывать пользователю только действительно доступные слоты

## Влияние на пользователей

Пользователи видят некорректные доступные слоты и не могут записаться на время, которое система показывает как свободное.