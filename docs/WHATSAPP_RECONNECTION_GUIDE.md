# WhatsApp Reconnection Guide

## üìã –ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- **–ü—Ä–æ–±–ª–µ–º–∞**: 3 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (session-pool, baileys-provider, pairing-code-manager)
- **–†–µ—à–µ–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ pairing code –ø—Ä—è–º–æ –≤ session-pool.js

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Pairing Code
- **–ü—Ä–æ–±–ª–µ–º–∞**: USE_PAIRING_CODE –Ω–µ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ª–æ–≥–∏–∫–∞ –≤ session-pool

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–ü—Ä–æ–±–ª–µ–º–∞**: whatsapp-monitor —É–¥–∞–ª—è–ª –≤—Å–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ rm -rf
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω whatsapp-safe-monitor.js –±–µ–∑ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –±—ç–∫–∞–ø–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞**: –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ creds.json
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ whatsapp-backup-manager.js

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é

### –®–∞–≥ 1: –î–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
git push origin feature/redis-context-cache

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh -i ~/.ssh/id_ed25519_ai_admin root@46.149.70.219
cd /opt/ai-admin
git pull origin feature/redis-context-cache
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ /opt/ai-admin/.env
echo "USE_PAIRING_CODE=true" >> .env
echo "WHATSAPP_PHONE_NUMBER=79686484488" >> .env
echo "WHATSAPP_MAX_QR_ATTEMPTS=3" >> .env
echo "WHATSAPP_MONITOR_ENABLED=false" >> .env
```

### –®–∞–≥ 3: –ë—ç–∫–∞–ø —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö auth —Ñ–∞–π–ª–æ–≤
node scripts/whatsapp-backup-manager.js backup 962302
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API

```bash
pm2 restart ai-admin-api
```

### –®–∞–≥ 5: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WhatsApp

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Pairing Code (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—Ä–æ—Å–∏—Ç—å pairing code —á–µ—Ä–µ–∑ API
curl -X POST http://localhost:3000/api/whatsapp/sessions/962302/pairing-code \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "79686484488"}'
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
```
http://46.149.70.219:3000/whatsapp-pairing.html
```

**–ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ WhatsApp
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –°–≤—è–∑–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. –ü—Ä–∏–≤—è–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
4. –ü—Ä–∏–≤—è–∑–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
5. –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–æ–¥

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ QR –∫–æ–¥ (–µ—Å–ª–∏ pairing –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å pairing code –≤—Ä–µ–º–µ–Ω–Ω–æ
export USE_PAIRING_CODE=false

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://46.149.70.219:3000/whatsapp-qr.html?company=962302
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl http://localhost:3000/webhook/whatsapp/baileys/status/962302

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs ai-admin-api --lines 50
```

### –®–∞–≥ 7: –ó–∞–ø—É—Å–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å —Å—Ç–∞—Ä—ã–π whatsapp-monitor!
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 start scripts/whatsapp-safe-monitor.js --name whatsapp-safe-monitor

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
pm2 save
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ù–ï –î–ï–õ–ê–¢–¨:
- ‚ùå –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å `scripts/whatsapp-auto-recovery.js` - –æ–Ω —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pm2 start whatsapp-monitor` - —Å—Ç–∞—Ä—ã–π –æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- ‚ùå –ù–ï —É–¥–∞–ª—è—Ç—å creds.json –≤—Ä—É—á–Ω—É—é

### –î–ï–õ–ê–¢–¨:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pairing code –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã —á–µ—Ä–µ–∑ backup-manager
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å safe-monitor –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±–æ–≤–∞—Ç—å reconnect, –∞ –Ω–µ cleanup

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### "Connection Closed"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
ls -la /opt/ai-admin/baileys_sessions/company_962302 | wc -l

# –ï—Å–ª–∏ > 150 —Ñ–∞–π–ª–æ–≤ - –∑–∞–ø—É—Å—Ç–∏—Ç—å —É–º–Ω—É—é –æ—á–∏—Å—Ç–∫—É
node scripts/whatsapp-smart-cleanup.js
```

### "Rate limit reached"
- –ü–æ–¥–æ–∂–¥–∞—Ç—å 30-60 –º–∏–Ω—É—Ç
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pairing code –≤–º–µ—Å—Ç–æ QR

### "Device logged out"
- –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞ –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ:
```bash
node scripts/whatsapp-backup-manager.js restore 962302
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π)
```bash
# –°—Ç–∞—Ç—É—Å
pm2 status whatsapp-safe-monitor

# –õ–æ–≥–∏
pm2 logs whatsapp-safe-monitor
```

### –†—É—á–Ω–æ–π
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:3000/api/whatsapp/sessions/962302/health

# –ú–µ—Ç—Ä–∏–∫–∏
curl http://localhost:3000/api/whatsapp/metrics
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
1. WhatsApp –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω —á–µ—Ä–µ–∑ pairing code
2. –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –ë—ç–∫–∞–ø—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 20 —Å–µ–Ω—Ç—è–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä**: AI Admin Team