# üìä Timeweb PostgreSQL - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–î–∞—Ç–∞:** 2025-10-31
**–°—Ç–∞—Ç—É—Å:** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (152-–§–ó —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω–∞ –ë–î –Ω–∞ Timeweb
- ‚úÖ PostgreSQL —Å–æ–∑–¥–∞–Ω
- ‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å VPS: `192.168.0.4:5432`
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `default_db`
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `gen_user`
- ‚úÖ –ü–∞—Ä–æ–ª—å: `}X|oM595A<7n?0`

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏: `docs/TIMEWEB_POSTGRES_MIGRATION.md`
- ‚úÖ Quick Start: `QUICK_START_TIMEWEB_POSTGRES.md`
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
  - `scripts/test-timeweb-connection.sh` - —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - `scripts/apply-schema-timeweb.sh` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã

### 3. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ PostgreSQL –º–æ–¥—É–ª—å: `src/database/postgres.js`
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `src/config/index.js` (database section)
- ‚úÖ .env —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–ª–æ–∫–∞–ª—å–Ω–æ + production example)

### 4. –†–µ–∂–∏–º dual-database
- ‚úÖ `USE_LEGACY_SUPABASE=true` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- ‚úÖ `USE_LEGACY_SUPABASE=false` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Timeweb PostgreSQL

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –≠—Ç–∞–ø 1: –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (1-2 —á–∞—Å–∞)
```bash
# –ù–∞ VPS
ssh root@46.149.70.219
cd /opt/ai-admin

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
./scripts/test-timeweb-connection.sh
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í–µ—Ä—Å–∏—è PostgreSQL 14+
- ‚úÖ –ü—Ä–∞–≤–∞ –Ω–∞ CREATE/INSERT/SELECT –µ—Å—Ç—å

---

### –≠—Ç–∞–ø 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã (2-3 —á–∞—Å–∞)
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ë–î
./scripts/apply-schema-timeweb.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞
psql 'postgresql://gen_user:%7DX%7CoM595A%3C7n%3F0@192.168.0.4:5432/default_db' -c "\dt"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã: companies, clients, bookings, services, staff, etc.
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

### –≠—Ç–∞–ø 3: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (4-6 —á–∞—Å–æ–≤)

#### 3.1 –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ Supabase
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ (TODO)
./scripts/export-supabase-data.sh
```

#### 3.2 –ò–º–ø–æ—Ä—Ç –≤ Timeweb
```bash
# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (TODO)
./scripts/import-timeweb-data.sh
```

#### 3.3 –í–∞–ª–∏–¥–∞—Ü–∏—è
```sql
-- –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT 'clients' as table, COUNT(*) FROM clients
UNION ALL
SELECT 'bookings', COUNT(*) FROM bookings
UNION ALL
SELECT 'staff', COUNT(*) FROM staff;
```

---

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-4 —á–∞—Å–∞)
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Timeweb PostgreSQL
export USE_LEGACY_SUPABASE=false

# –¢–µ—Å—Ç –º–æ–¥—É–ª—è
node -e "
require('dotenv').config();
const postgres = require('./src/database/postgres');
postgres.query('SELECT NOW()').then(r => console.log('‚úÖ', r.rows));
"

# –¢–µ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 restart all
pm2 logs --lines 100
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- ‚úÖ WhatsApp —Å–µ—Å—Å–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –ó–∞–ø–∏—Å–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ë–î

---

### –≠—Ç–∞–ø 5: Production –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (1 –¥–µ–Ω—å)
```bash
# –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ VPS
echo "USE_LEGACY_SUPABASE=false" >> /opt/ai-admin/.env

# Restart
pm2 restart all

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 24 —á–∞—Å–∞
pm2 monit
```

---

## üí∞ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Supabase | Timeweb PostgreSQL |
|----------|----------|-------------------|
| **–õ–æ–∫–∞—Ü–∏—è** | –ó–∞ —Ä—É–±–µ–∂–æ–º | –†–§ (152-–§–ó ‚úÖ) |
| **–õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | 50-100ms | <1ms (–≤–Ω—É—Ç—Ä–∏ VPS) |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç Supabase | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | $0 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è) | ~1,500‚ÇΩ/–º–µ—Å |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –ë–∞–∑–æ–≤–∞—è | 50-100x –±—ã—Å—Ç—Ä–µ–µ |

---

## üîÑ Rollback –ø–ª–∞–Ω

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**
```bash
# –í–µ—Ä–Ω—É—Ç—å Supabase
export USE_LEGACY_SUPABASE=true
pm2 restart all

# –ü—Ä–æ–≤–µ—Ä–∫–∞
pm2 logs --lines 50
```

**–í—Ä–µ–º—è –æ—Ç–∫–∞—Ç–∞:** <5 –º–∏–Ω—É—Ç

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏

```
docs/
‚îú‚îÄ‚îÄ TIMEWEB_POSTGRES_MIGRATION.md     # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ TIMEWEB_POSTGRES_SUMMARY.md       # –≠—Ç–∞ —Å–≤–æ–¥–∫–∞
‚îî‚îÄ‚îÄ QUICK_START_TIMEWEB_POSTGRES.md   # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

scripts/
‚îú‚îÄ‚îÄ test-timeweb-connection.sh         # –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ apply-schema-timeweb.sh            # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ export-supabase-data.sh            # TODO: –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ import-timeweb-data.sh             # TODO: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

src/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ supabase.js                    # Legacy Supabase
‚îÇ   ‚îî‚îÄ‚îÄ postgres.js                    # NEW: Timeweb PostgreSQL
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ index.js                       # –û–±–Ω–æ–≤–ª–µ–Ω: database section

.env                                    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
.env.production.example                 # Production —à–∞–±–ª–æ–Ω
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- [x] PostgreSQL —Å–æ–∑–¥–∞–Ω –Ω–∞ Timeweb
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –°–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- [x] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (TODO)
- [ ] –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase
- [ ] –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Timeweb
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] Production –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 24 —á–∞—Å–∞

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (TODO)
- [ ] –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Supabase
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ö–æ–º–∞–Ω–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∞

---

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Å—Ç–∞—Ä—Ç—É

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –Ω–∞—á–∞–ª—É –º–∏–≥—Ä–∞—Ü–∏–∏

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 1-2 –¥–Ω—è (–≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è)

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
```bash
ssh root@46.149.70.219
cd /opt/ai-admin
./scripts/test-timeweb-connection.sh
```

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `pm2 logs --lines 100`
2. Rollback –Ω–∞ Supabase: `USE_LEGACY_SUPABASE=true`
3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/TIMEWEB_POSTGRES_MIGRATION.md`

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2025-10-31*
*–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏* üöÄ
