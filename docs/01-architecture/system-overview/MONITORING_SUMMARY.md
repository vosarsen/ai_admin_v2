# ๐ AI Admin - ะกะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ะธ ัะฟัะฐะฒะปะตะฝะธั

*ะกะพะทะดะฐะฝะพ: 18 ัะตะฝััะฑัั 2025*

## ๐ฏ ะงัะพ ะฑัะปะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ

### 1. Health Check System
**Endpoint**: `GET /health`

ะัะพะฒะตััะตั ะฒัะต ะบัะธัะธัะตัะบะธะต ะบะพะผะฟะพะฝะตะฝัั:
- โ Redis ะฟะพะดะบะปััะตะฝะธะต ะธ ะบะพะปะธัะตััะฒะพ ะบะปััะตะน
- โ ะะฐะทะฐ ะดะฐะฝะฝัั (Supabase) ะดะพัััะฟะฝะพััั
- โ WhatsApp ััะฐััั ัะตััะธะธ
- โ ะัะตัะตะดั ัะพะพะฑัะตะฝะธะน (BullMQ)
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ
- โ ะะพัะปะตะดะฝัั ะฐะบัะธะฒะฝะพััั

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
{
  "status": "ok",
  "checks": {
    "redis": { "status": "ok", "connected": true, "keys": 498 },
    "database": { "status": "ok", "connected": true },
    "whatsapp": { "status": "ok", "connected": true },
    "queue": { "status": "ok", "totalJobs": 14 },
    "memory": { "status": "ok", "rssMB": 165, "percentage": 97 },
    "lastActivity": { "status": "ok", "lastMessageMinutesAgo": 5 }
  }
}
```

### 2. Recovery Script
**ะคะฐะนะป**: `scripts/recovery.sh`

ะะพะผะฐะฝะดั ะฒะพัััะฐะฝะพะฒะปะตะฝะธั:
```bash
./recovery.sh          # ะะพะปะฝะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต
./recovery.sh soft     # ะัะณะบะธะน ัะตััะฐัั ะฟัะพัะตััะพะฒ
./recovery.sh whatsapp # ะะพัััะฐะฝะพะฒะปะตะฝะธะต WhatsApp
./recovery.sh redis    # ะัะธััะบะฐ ะฟัะพะฑะปะตะผะฝัั ะบะปััะตะน Redis
./recovery.sh company 962302  # ะะพัััะฐะฝะพะฒะปะตะฝะธะต ะบะพะฝะบัะตัะฝะพะน ะบะพะผะฟะฐะฝะธะธ
./recovery.sh status   # ะะพะบะฐะทะฐัั ััะฐััั ัะธััะตะผั
./recovery.sh check    # ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
```

### 3. Telegram ะธะฝัะตะณัะฐัะธั

#### ะะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั
ะัะฟัะฐะฒะปััััั ะฟัะธ:
- ๐จ ะัะธัะธัะตัะบะธั ะพัะธะฑะบะฐั (API ะฝะต ะพัะฒะตัะฐะตั, Redis ัะฟะฐะป)
- ๐ฑ ะัะพะฑะปะตะผะฐั ั WhatsApp (ะพัะบะปััะตะฝะธะต, ะฝัะถะตะฝ QR-ะบะพะด)
- โ๏ธ ะััะพะบะพะน ะฝะฐะณััะทะบะต (ะฟะฐะผััั >500MB, ะพัะตัะตะดั >20)
- โ ะฃัะฟะตัะฝัั ะฒะพัััะฐะฝะพะฒะปะตะฝะธัั

#### ะะฝัะตัะฐะบัะธะฒะฝัะน ะฑะพั
**ะะพะผะฐะฝะดั:**
- `/status` - ััะฐััั ะฒัะตั PM2 ะฟัะพัะตััะพะฒ
- `/health` - ะดะตัะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
- `/restart [service]` - ะฟะตัะตะทะฐะฟััะบ ัะตัะฒะธัะฐ
- `/recover [type]` - ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ัะธััะตะผั
- `/logs` - ะฟะพัะปะตะดะฝะธะต ะพัะธะฑะบะธ ะธะท ะปะพะณะพะฒ
- `/queue` - ัะพััะพัะฝะธะต ะพัะตัะตะดะธ ัะพะพะฑัะตะฝะธะน
- `/test` - ะพัะฟัะฐะฒะธัั ัะตััะพะฒะพะต ัะพะพะฑัะตะฝะธะต

### 4. ะะฒัะพะผะฐัะธัะตัะบะธะน ะผะพะฝะธัะพัะธะฝะณ
**ะคะฐะนะป**: `scripts/health-monitor.js`

ะะฐะฟััะบะฐะตััั ัะตัะตะท cron ะบะฐะถะดัะต 5 ะผะธะฝัั:
```bash
*/5 * * * * /usr/bin/node /opt/ai-admin/scripts/health-monitor.js
```

ะคัะฝะบัะธะธ:
- ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะธััะตะผั
- ะะฒัะพะผะฐัะธัะตัะบะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะธะทะฒะตััะฝัั ะฟัะพะฑะปะตะผ
- ะัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน ะฒ Telegram
- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะดะตะนััะฒะธะน

## ๐ง ะัะฟัะฐะฒะปะตะฝะฝัะต ะฟัะพะฑะปะตะผั

### 1. YclientsClient constructor error
- **ะกะธะผะฟัะพะผั**: 283 ัะตััะฐััะฐ API ะทะฐ 2 ะดะฝั
- **ะัะธัะธะฝะฐ**: ะัะพะฑะปะตะผะฐ ั ะบััะตะผ require ะฒ PM2
- **ะะตัะตะฝะธะต**: ะะตัะตะทะฐะฟััะบ API ะพัะธััะธะป ะบัั

### 2. WhatsApp ัะตััะธั
- **ะกะธะผะฟัะพะผั**: "Bad MAC Error", Connection Closed
- **ะัะธัะธะฝะฐ**: ะะพะฒัะตะถะดะตะฝะธะต ะบัะธะฟัะพะณัะฐัะธัะตัะบะธั ะบะปััะตะน ัะตััะธะธ
- **ะะตัะตะฝะธะต**: ะฃะดะฐะปะตะฝะธะต ััะฐััั ัะตััะธะน ะธ ะฟะตัะตะฟะพะดะบะปััะตะฝะธะต

### 3. ะัะตัะตะดั ัะพะพะฑัะตะฝะธะน
- **ะกะธะผะฟัะพะผั**: 162 ะฝะฐะบะพะฟะธะฒัะธััั ะทะฐะดะฐัะธ
- **ะัะธัะธะฝะฐ**: ะกะฑะพะธ ะฒ ะพะฑัะฐะฑะพัะบะต ะฝะต ะพัะธัะฐะปะธ ะพัะตัะตะดั
- **ะะตัะตะฝะธะต**: ะัะธััะบะฐ ัะตัะตะท Redis CLI

### 4. ะัะพะฑัะฐะถะตะฝะธะต ััะฐัััะฐ
- **ะกะธะผะฟัะพะผั**: WhatsApp ะฟะพะบะฐะทัะฒะฐะป "ะพัะบะปััะตะฝ", "undefined ะผะธะฝัั ะฝะฐะทะฐะด"
- **ะัะธัะธะฝะฐ**: ะะตะฟัะฐะฒะธะปัะฝะฐั ะฟัะพะฒะตัะบะฐ ััะฐัััะฐ, ะบะพัะพัะบะธะน TTL ะดะปั ะบะปััะตะน
- **ะะตัะตะฝะธะต**: ะะปััะตัะฝะฐัะธะฒะฝัะต ะผะตัะพะดั ะฟัะพะฒะตัะบะธ, TTL ัะฒะตะปะธัะตะฝ ะดะพ 24 ัะฐัะพะฒ

## ๐ ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)
```bash
# Telegram notifications
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here
```

### PM2 ะฟัะพัะตััั
```javascript
// ecosystem.config.js ะดะพะฑะฐะฒะปะตะฝ:
{
  name: 'ai-admin-telegram-bot',
  script: './scripts/telegram-bot.js',
  max_memory_restart: '100M',
  autorestart: true
}
```

### Cron ะทะฐะดะฐัะธ
```bash
# Health monitoring every 5 minutes
*/5 * * * * /usr/bin/node /opt/ai-admin/scripts/health-monitor.js >> /opt/ai-admin/logs/health-monitor.log 2>&1
```

## ๐ ะขะตะบััะตะต ัะพััะพัะฝะธะต ัะธััะตะผั

### ะะตััะธะบะธ ััะฐะฑะธะปัะฝะพััะธ:
- **API ัะตััะฐััั**: 0 ะทะฐ ะฟะพัะปะตะดะฝะธะน ัะฐั (ะฑัะปะพ 283 ะทะฐ 2 ะดะฝั)
- **ะัะตัะตะดั**: 14 ะทะฐะดะฐั (ะฑัะปะพ 162)
- **ะะฐะผััั**: ~160MB ะฝะฐ ะฟัะพัะตัั (ะฝะพัะผะฐ)
- **WhatsApp**: ะะพะดะบะปััะตะฝ ะธ ัะฐะฑะพัะฐะตั
- **ะัะตะผั ะพัะฒะตัะฐ**: 9-10 ัะตะบัะฝะด

### PM2 ะฟัะพัะตััั:
```
โโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโ
โ id โ name                    โ mode โ status โ restarts โ memory   โ
โโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโผโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโค
โ 7  โ ai-admin-api           โ fork โ online โ 288      โ 161MB    โ
โ 8  โ ai-admin-batch-processorโ fork โ online โ 2        โ 76MB     โ
โ 5  โ ai-admin-booking-monitorโ fork โ online โ 1        โ 129MB    โ
โ 2  โ ai-admin-reminder      โ fork โ online โ 4        โ 121MB    โ
โ 13 โ ai-admin-telegram-bot  โ fork โ online โ 0        โ 65MB     โ
โ 4  โ ai-admin-worker-v2     โ fork โ online โ 3        โ 91MB     โ
โโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโดโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโ
```

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะััััะฐั ะฟัะพะฒะตัะบะฐ ััะฐัััะฐ:
```bash
# ะงะตัะตะท Telegram ะฑะพัะฐ
/status

# ะงะตัะตะท SSH
curl localhost:3000/health | jq

# ะงะตัะตะท recovery script
./recovery.sh status
```

### ะัะธ ะฟัะพะฑะปะตะผะฐั:
```bash
# 1. ะัะพะฒะตัะธัั ััะฐััั
./recovery.sh status

# 2. ะัะณะบะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต
./recovery.sh soft

# 3. ะัะปะธ ะฝะต ะฟะพะผะพะณะปะพ - ะฟะพะปะฝะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต
./recovery.sh full

# 4. ะัะพะฒะตัะธัั ะปะพะณะธ
pm2 logs --err --lines 50
```

### ะะพะฝะธัะพัะธะฝะณ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ:
```bash
# PM2 dashboard
pm2 monit

# ะกะปะตะดะธัั ะทะฐ ะปะพะณะฐะผะธ
pm2 logs --follow

# Telegram ะฑะพั
/health - ะดะปั ะดะตัะฐะปัะฝะพะณะพ ััะฐัััะฐ
```

## ๐ ะะพะบัะผะตะฝัะฐัะธั

### ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั:
- `docs/development-diary/2025-09-18-monitoring-system.md` - ะดะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะตะฐะปะธะทะฐัะธะธ
- `docs/QUICK_REFERENCE.md` - ะบัะฐัะบะฐั ัะฟะฐัะณะฐะปะบะฐ ะบะพะผะฐะฝะด
- `docs/TELEGRAM_SETUP.md` - ะธะฝััััะบัะธั ะฝะฐัััะพะนะบะธ Telegram
- `docs/MONITORING_SUMMARY.md` - ััะพั ะดะพะบัะผะตะฝั

### ะะฑะฝะพะฒะปะตะฝะฝัะต ัะฐะนะปั:
- `config/project-docs/CONTEXT.md` - ัะตะบััะตะต ัะพััะพัะฝะธะต ะฟัะพะตะบัะฐ
- `config/project-docs/TASK.md` - ะฒัะฟะพะปะฝะตะฝะฝัะต ะทะฐะดะฐัะธ
- `ecosystem.config.js` - ะบะพะฝัะธะณััะฐัะธั PM2
- `.env` - ะดะพะฑะฐะฒะปะตะฝั Telegram ะฟะตัะตะผะตะฝะฝัะต

## โ ะะตะทัะปััะฐั

ะกะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ะธ ะฒะพัััะฐะฝะพะฒะปะตะฝะธั ะฟะพะปะฝะพัััั ััะฝะบัะธะพะฝะฐะปัะฝะฐ:
- **ะะธะดะธะผะพััั** - ะฒัะตะณะดะฐ ะทะฝะฐะตะผ ัะพััะพัะฝะธะต ัะธััะตะผั ัะตัะตะท health endpoint
- **ะะพะฝััะพะปั** - ัะฟัะฐะฒะปะตะฝะธะต ัะตัะตะท Telegram ะฑะพั ั ัะตะปะตัะพะฝะฐ
- **ะะฒัะพะผะฐัะธะทะฐัะธั** - ะฟัะพะฑะปะตะผั ะดะตัะตะบัะธัััััั ะธ ะธัะฟัะฐะฒะปััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- **ะะฐะดัะถะฝะพััั** - ะฑััััะพะต ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน
- **ะฃะฒะตะดะพะผะปะตะฝะธั** - ะบัะธัะธัะตัะบะธะต ัะพะฑััะธั ะฟัะธัะพะดัั ะฒ Telegram

**ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ production ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะธ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั ะดะพ 5-10 ะบะพะผะฟะฐะฝะธะน.**