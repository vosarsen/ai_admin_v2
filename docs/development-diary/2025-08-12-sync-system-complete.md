# –°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ YClients ‚Üí Supabase - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìÖ –î–∞—Ç–∞: 12 –∞–≤–≥—É—Å—Ç–∞ 2025
## üë§ –ê–≤—Ç–æ—Ä: AI Admin Team

## üéØ –¶–µ–ª—å
–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É YClients –∏ Supabase –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö
- **–ö–ª–∏–µ–Ω—Ç–æ–≤**: 1,097
- **–ö–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤–∏–∑–∏—Ç–∞–º–∏**: ~400+
- **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤**: 3-5 –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
- **–û–±—â–∏–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö**: ~4,000 –∑–∞–ø–∏—Å–µ–π –≤–∏–∑–∏—Ç–æ–≤

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤**: 14 —Å–µ–∫—É–Ω–¥
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–∏–∑–∏—Ç–æ–≤**: ~500ms –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
- **–û–±—â–µ–µ –≤—Ä–µ–º—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: ~10-15 –º–∏–Ω—É—Ç

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
YClients API
     ‚Üì
SyncManager (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä)
     ‚îú‚îÄ‚îÄ ClientsSyncOptimized (–±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤)
     ‚îú‚îÄ‚îÄ ClientRecordsSync (–∏—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤)
     ‚îú‚îÄ‚îÄ GoodsTransactionsSync (—Ç–æ–≤–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
     ‚îú‚îÄ‚îÄ ServicesSync (—É—Å–ª—É–≥–∏)
     ‚îú‚îÄ‚îÄ StaffSync (–º–∞—Å—Ç–µ—Ä–∞)
     ‚îî‚îÄ‚îÄ SchedulesSync (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è)
     ‚Üì
Supabase Database
```

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
src/sync/
‚îú‚îÄ‚îÄ sync-manager.js          # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤—Å–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ clients-sync-optimized.js # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ client-records-sync.js    # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤–∏–∑–∏—Ç–æ–≤
‚îú‚îÄ‚îÄ goods-transactions-sync.js # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îú‚îÄ‚îÄ services-sync.js          # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å–ª—É–≥
‚îú‚îÄ‚îÄ staff-sync.js            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ schedules-sync.js        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
‚îî‚îÄ‚îÄ sync-utils.js           # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
```

## üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

| –í—Ä–µ–º—è | –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è | –ß–∞—Å—Ç–æ—Ç–∞ |
|-------|---------------------|---------|
| 01:00 | –£—Å–ª—É–≥–∏ | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ |
| 02:00 | –ú–∞—Å—Ç–µ—Ä–∞ | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ |
| 03:00 | **–ö–ª–∏–µ–Ω—Ç—ã + –í–∏–∑–∏—Ç—ã + –¢–æ–≤–∞—Ä—ã** | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ |
| */4 —á–∞—Å–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏—è | 6 —Ä–∞–∑ –≤ –¥–µ–Ω—å |
| */15 –º–∏–Ω—É—Ç | –ë—É–∫–∏–Ω–≥–∏ | 96 —Ä–∞–∑ –≤ –¥–µ–Ω—å |
| 00:00 –í–° | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ |

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (03:00)

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
```javascript
// clients-sync-optimized.js
1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ YClients (–ø–∞–≥–∏–Ω–∞—Ü–∏—è –ø–æ 200)
2. –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–±–∞—Ç—á–∏ –ø–æ 50)
3. Upsert –≤ Supabase —Å –ø–æ–ª—è–º–∏:
   - name, phone, email
   - total_spent (–∏–∑ sold_amount YClients)
   - visits_count
   - birthday, gender
   - created_at, updated_at
```

### –≠—Ç–∞–ø 2: –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤
```javascript
// client-records-sync.js
1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å visits_count >= 1
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–µ–π –∑–∞ 2 –≥–æ–¥–∞ –∏–∑ YClients
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π:
     * visit_history (–ø–æ–ª–Ω—ã–π –º–∞—Å—Å–∏–≤ –≤–∏–∑–∏—Ç–æ–≤)
     * last_services (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —É—Å–ª—É–≥–∏)
     * services_amount (—Å—É–º–º–∞ —É—Å–ª—É–≥)
     * goods_amount (—Ä–∞–∑–Ω–∏—Ü–∞ total_spent - services_amount)
     * loyalty_level (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∏–∑–∏—Ç–æ–≤ –∏ —Å—É–º–º—ã)
```

### –≠—Ç–∞–ø 3: –¢–æ–≤–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```javascript
// goods-transactions-sync.js
1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ YClients
2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ goods_amount –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
```

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∏–ª–∏
–ü—Ä–∏ –æ–±—ã—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–ª—è `visit_history` –∏ `last_services` –º–æ–≥–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –ø—É—Å—Ç—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ –¥—Ä—É–≥–æ–≥–æ endpoint.

### –†–µ—à–µ–Ω–∏–µ
```javascript
// clients-sync-optimized.js, —Å—Ç—Ä–æ–∫–∏ 296-297
delete data.last_services;
delete data.visit_history;
```
–≠—Ç–∏ –ø–æ–ª—è –ù–ï —Ç—Ä–æ–≥–∞—é—Ç—Å—è –ø—Ä–∏ –±–∞–∑–æ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–∏–∑–∏—Ç–æ–≤.

### –í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å
- –≠—Ç–æ –ù–ï –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –ü—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–∏–∑–∏—Ç–æ–≤ –¥–∞–Ω–Ω—ã–µ –ü–û–õ–ù–û–°–¢–¨–Æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–≤–µ–∂–∏–º–∏ –∏–∑ YClients

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ clients - –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
```sql
-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
total_spent      DECIMAL  -- –û–±—â–∞—è —Å—É–º–º–∞ (–∏–∑ YClients sold_amount)
services_amount  DECIMAL  -- –°—É–º–º–∞ —Ç–æ–ª—å–∫–æ —É—Å–ª—É–≥
goods_amount     DECIMAL  -- –°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤
average_bill     DECIMAL  -- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫

-- –ò—Å—Ç–æ—Ä–∏—è
visit_count      INTEGER  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤
visit_history    JSONB[]  -- –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –≤–∏–∑–∏—Ç–æ–≤
last_services    TEXT[]   -- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏
first_visit_date DATE     -- –ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç
last_visit_date  DATE     -- –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç

-- –õ–æ—è–ª—å–Ω–æ—Å—Ç—å
loyalty_level    TEXT     -- New/Bronze/Silver/Gold/VIP
client_segment   TEXT     -- –°–µ–≥–º–µ–Ω—Ç –∫–ª–∏–µ–Ω—Ç–∞
```

### –§–æ—Ä–º–∞—Ç visit_history
```json
[
  {
    "date": "2025-05-28 14:15:00",
    "services": ["–ú–û–î–ï–õ–ò–†–û–í–ê–ù–ò–ï –ë–û–†–û–î–´"],
    "staff": "–ë–∞—Ä–∏",
    "cost": 1800,
    "status": "attended",
    "attendance": 1
  }
]
```

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```bash
# –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ–≥–æ
node scripts/manual-sync.js full

# –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—ã –ë–ï–ó –≤–∏–∑–∏—Ç–æ–≤
node scripts/manual-sync.js clients

# –ö–ª–∏–µ–Ω—Ç—ã –° –≤–∏–∑–∏—Ç–∞–º–∏
SYNC_CLIENT_VISITS=true node scripts/manual-sync.js clients

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
node scripts/manual-sync.js status
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
node scripts/check-sync-status.js

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
node check-client-stats.js

# –õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
pm2 logs ai-admin-worker-v2 | grep sync
```

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 12 –∞–≤–≥—É—Å—Ç–∞ 2025

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ total_spent –∏–∑ YClients**
   - –ü–µ—Ä–µ—Å—Ç–∞–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å total_spent –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–∏–∑–∏—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º sold_amount –∏–∑ YClients –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º**
   - –î–æ–±–∞–≤–∏–ª–∏ services_amount (—Å—É–º–º–∞ —É—Å–ª—É–≥ –∏–∑ –≤–∏–∑–∏—Ç–æ–≤)
   - –î–æ–±–∞–≤–∏–ª–∏ goods_amount (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ —Ä–∞–∑–Ω–∏—Ü–∞)

3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö**
   - visit_history –∏ last_services –Ω–µ –∑–∞—Ç–∏—Ä–∞—é—Ç—Å—è –ø—Ä–∏ –±–∞–∑–æ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤–∏–∑–∏—Ç–æ–≤

4. **–í–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
   - syncVisitHistory: true –≤ –Ω–æ—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - maxVisitsSync: 10000 (–≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã)

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ 100% –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–∞–∂–¥—É—é –Ω–æ—á—å
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤–∏–∑–∏—Ç–∞–º–∏
- ‚úÖ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ—á–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ —É—Å–ª—É–≥–∏ –∏ —Ç–æ–≤–∞—Ä—ã
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
SELECT 
  COUNT(*) as total_clients,
  COUNT(CASE WHEN visit_history IS NOT NULL AND visit_history != '[]' THEN 1 END) as with_history,
  COUNT(CASE WHEN last_services IS NOT NULL AND last_services != '{}' THEN 1 END) as with_services,
  COUNT(CASE WHEN total_spent > 0 THEN 1 END) as with_spending
FROM clients;

-- –¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã –ø–æ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
SELECT name, phone, visit_count, total_spent, loyalty_level
FROM clients
WHERE visit_count > 0
ORDER BY total_spent DESC
LIMIT 10;
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ:
- –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—É—é –Ω–æ—á—å
- –ò—Å—Ç–æ—Ä–∏—è –≤–∏–∑–∏—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ—á–Ω—ã –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã
- –ù–µ—Ç —Ä–∏—Å–∫–∞ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üìù –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

1. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ clients - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–∞ –ª–∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
2. –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—è –≤–∏–∑–∏—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
4. –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏