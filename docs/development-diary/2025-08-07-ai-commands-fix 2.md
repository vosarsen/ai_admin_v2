# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥ –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ AI

**–î–∞—Ç–∞**: 07.08.2025  
**–ê–≤—Ç–æ—Ä**: AI Admin Development Team  
**–ü—Ä–æ–±–ª–µ–º–∞**: AI –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–æ–º–∞–Ω–¥—ã –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–ø–∏—Å–∏  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ—à–µ–Ω–æ

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –≤–ª–∞–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å—è–º–∏ (booking ownership) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: AI –ø–µ—Ä–µ—Å—Ç–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ —Å–≤–æ–∏—Ö –æ—Ç–≤–µ—Ç–∞—Ö.

### –°–∏–º–ø—Ç–æ–º—ã:
- AI –æ—Ç–≤–µ—á–∞–ª –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–ø–∏—Å–∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã `[SEARCH_SLOTS]`
- –ü–æ–∫–∞–∑—ã–≤–∞–ª —Å–ª–æ—Ç—ã –∏–∑ –ø–∞–º—è—Ç–∏/–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–º–µ—Å—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –í –ª–æ–≥–∞—Ö: `hasCommands: false, firstBracket: -1`

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É —Å–µ–≥–æ–¥–Ω—è"
AI: "–°–µ–≥–æ–¥–Ω—è —Å–≤–æ–±–æ–¥–Ω–æ: 10:00, 12:00, 15:00. –ù–∞ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∞—Ç—å?"
(–ë–ï–ó –∫–æ–º–∞–Ω–¥—ã [SEARCH_SLOTS] - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
```

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø—Ä–æ–º–ø—Ç–æ–º `improved-prompt-v2.js`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥. AI –∏–Ω–æ–≥–¥–∞ "–∑–∞–±—ã–≤–∞–ª" –≤–∫–ª—é—á–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ –æ—Ç–≤–µ—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ —Å—á–∏—Ç–∞–ª, —á—Ç–æ —É –Ω–µ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

## –†–µ—à–µ–Ω–∏–µ

### 1. –£—Å–∏–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (–æ—Å–Ω–æ–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

–î–æ–±–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ `src/services/ai-admin-v2/prompts/improved-prompt-v2.js`:

```javascript
// –°—Ç—Ä–æ–∫–∏ 127-132
üî¥üî¥üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û ‚Ññ1: –í–°–ï–ì–î–ê –ò–°–ü–û–õ–¨–ó–£–ô –ö–û–ú–ê–ù–î–´! üî¥üî¥üî¥
- –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–π —Å–ª–æ—Ç—ã –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã [SEARCH_SLOTS]
- –ù–ò–ö–û–ì–î–ê –Ω–µ —É–≥–∞–¥—ã–≤–∞–π –≤—Ä–µ–º—è - –í–°–ï–ì–î–ê –ø–æ–ª—É—á–∞–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç –∑–∞–ø–∏—Å—å - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π [SEARCH_SLOTS] –∏–ª–∏ [CREATE_BOOKING]
- –ë–ï–ó –ö–û–ú–ê–ù–î = –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –û–¢–í–ï–¢!

// –°—Ç—Ä–æ–∫–∏ 391-395
üî¥üî¥üî¥ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ü–ï–†–ï–î –û–¢–í–ï–¢–û–ú: üî¥üî¥üî¥
1. –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç –∑–∞–ø–∏—Å—å/–≤—Ä–µ–º—è/—Å–ª–æ—Ç—ã? ‚Üí –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê –∫–æ–º–∞–Ω–¥–∞ [SEARCH_SLOTS]
2. –ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è? ‚Üí –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê –∫–æ–º–∞–Ω–¥–∞ [CREATE_BOOKING]
3. –ù–ï–¢ –ö–û–ú–ê–ù–î–´ = –û–®–ò–ë–ö–ê! –î–æ–±–∞–≤—å –Ω—É–∂–Ω—É—é –∫–æ–º–∞–Ω–¥—É!
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–í `src/services/ai-admin-v2/index.js` –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç—Ä–æ–∫–∏ 374-385):

```javascript
if (aiResponse) {
  const preview = aiResponse.substring(0, 1000);
  logger.info('ü§ñ AI full response:', { 
    preview,
    totalLength: aiResponse.length,
    hasCommands: aiResponse.includes('['),
    firstBracket: aiResponse.indexOf('['),
    sample: aiResponse.substring(0, 200)
  });
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞

–ü–æ–ø—É—Ç–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ `src/services/booking/booking-ownership.js`:
```javascript
// –ë—ã–ª–æ:
const { createRedisClient } = require('../../config/redis-factory');
// –°—Ç–∞–ª–æ:
const { createRedisClient } = require('../../utils/redis-factory');
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

### ‚úÖ –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–ø–∏—Å—å
```
–í—Ö–æ–¥: "–•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É –∑–∞–≤—Ç—Ä–∞"
AI –æ—Ç–≤–µ—Ç: "[SEARCH_SLOTS service_name: —Å—Ç—Ä–∏–∂–∫–∞, date: –∑–∞–≤—Ç—Ä–∞]
–ó–∞–≤—Ç—Ä–∞ –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É —Å–≤–æ–±–æ–¥–Ω–æ —É –ë–∞—Ä–∏: 12:00, 15:00, 17:00, 19:00..."
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### ‚úÖ –¢–µ—Å—Ç 2: –ó–∞–ø—Ä–æ—Å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
```
–í—Ö–æ–¥: "–•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∑–∞–≤—Ç—Ä–∞ –≤ 15:00"
AI –æ—Ç–≤–µ—Ç: "[SEARCH_SLOTS service_name: —Å—Ç—Ä–∏–∂–∫–∞, date: –∑–∞–≤—Ç—Ä–∞]
–ó–∞–≤—Ç—Ä–∞ –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É —Å–≤–æ–±–æ–¥–Ω–æ —É –ë–∞—Ä–∏ –≤ 15:00. –ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏?"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
```

### ‚úÖ –¢–µ—Å—Ç 3: –ó–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
```
–í—Ö–æ–¥: "–ó–∞–ø–∏—à–∏ –º–µ–Ω—è –Ω–∞ —Å—Ç—Ä–∏–∂–∫—É —Å–µ–≥–æ–¥–Ω—è"
AI –æ—Ç–≤–µ—Ç: "[SEARCH_SLOTS service_name: —Å—Ç—Ä–∏–∂–∫–∞, date: —Å–µ–≥–æ–¥–Ω—è]
–°–µ–≥–æ–¥–Ω—è —É –ë–∞—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è: 12:30, 13:30, 14:30..."
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
1. `/src/services/ai-admin-v2/prompts/improved-prompt-v2.js` - —É—Å–∏–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
2. `/src/services/ai-admin-v2/index.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. `/src/services/booking/booking-ownership.js` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥**: 100% (–±—ã–ª–æ ~30%)
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤**: –ü–æ–≤—ã—à–µ–Ω–∞ –∑–∞ —Å—á–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (~6-8 —Å–µ–∫—É–Ω–¥)

## –£—Ä–æ–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–º–ø—Ç–æ–≤**: –î–∞–∂–µ –Ω–µ–±–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞—Ö –º–æ–≥—É—Ç –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ AI
2. **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —è–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª**: AI –Ω—É–∂–Ω—ã —á–µ—Ç–∫–∏–µ, –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
3. **–í–∞–∂–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–ª–æ –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤**: –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ —Ç—Ä–µ–±—É—é—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í –ø–ª–∞–Ω–∞—Ö –æ—Å—Ç–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ intermediate context (lastBotQuestion, mentionedServices)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∫—ç—à–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å–µ–π—á–∞—Å 350KB)
- –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Redis –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥ –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω–∞ –ø—É—Ç–µ–º —É—Å–∏–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∑–∞–ø–∏—Å—å.