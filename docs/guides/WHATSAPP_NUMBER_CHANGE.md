# Руководство по смене номера WhatsApp

## Описание

Это руководство описывает процесс смены номера телефона WhatsApp, к которому привязан Venom Bot. Процедура требует удаления текущей сессии и создания новой.

## Пошаговая инструкция

### 1. Подключение к серверу

```bash
ssh -i ~/.ssh/id_ed25519_ai_admin root@46.149.70.219
```

### 2. Остановка Venom Bot

```bash
pm2 stop venom-bot
```

Убедитесь, что процесс остановлен:
```bash
pm2 status
```

### 3. Удаление старой сессии

```bash
cd /opt/venom-bot
rm -rf tokens/ai-admin-session
```

⚠️ **Важно**: Это удалит текущую сессию WhatsApp. После этого старый номер будет отключен от бота.

### 4. Запуск Venom Bot для новой авторизации

```bash
pm2 start venom-bot
```

### 5. Получение QR кода

```bash
pm2 logs venom-bot --lines 100
```

QR код выглядит как большой квадрат из символов ▄▀█. Пример:
```
▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
█ ▄▄▄▄▄ █▄▄▀▄███▀▀  ▄▀▄▀▄ ▀█  ▄▄▀▀█▀▄ ▀█▀▀█  
█ █   █ █ ██ ▄▄█▄█▀▀▄▄ ▄▀▀ █▀██▄█▄█▄  ██████ 
█ █▄▄▄█ █▄█▄ █▀█▀▀▄▀ ▀█  █▀ ▄▄▄ ▀█ ▀▄▀  ▄ █▀
...
```

### 6. Сканирование QR кода

На телефоне с новым номером WhatsApp:
1. Откройте WhatsApp
2. Перейдите в **Настройки** (три точки в правом верхнем углу)
3. Выберите **Связанные устройства**
4. Нажмите **Привязать устройство**
5. Отсканируйте QR код с экрана

### 7. Проверка подключения

После сканирования проверьте статус:
```bash
pm2 logs venom-bot --lines 20
```

Должны увидеть сообщения:
- `Successfully connected!`
- `[instance: ai-admin-session]: Connected`
- `Successfully main page!`

### 8. Проверка работоспособности

Отправьте тестовое сообщение на новый номер и проверьте логи:
```bash
pm2 logs ai-admin-worker-v2 --lines 20
```

## Полезные команды

### Мониторинг в реальном времени
```bash
pm2 logs venom-bot --follow
```
(Нажмите Ctrl+C для выхода)

### Если QR код не появляется
```bash
pm2 restart venom-bot
pm2 logs venom-bot --lines 100
```

### Проверка всех процессов
```bash
pm2 status
```

## Возможные проблемы

### QR код обновляется слишком быстро
- QR код обновляется каждую минуту
- Если не успели отсканировать, подождите новый

### Процесс постоянно перезапускается
Проверьте ошибки:
```bash
pm2 logs venom-bot --err --lines 50
```

### Сессия не сохраняется
Проверьте права доступа:
```bash
ls -la /opt/venom-bot/tokens/
```

## Безопасность

- Сессия WhatsApp хранится локально на сервере
- Папка `tokens/` содержит конфиденциальные данные
- Не делитесь содержимым папки `tokens/`
- При смене номера старая сессия удаляется полностью

## Автоматизация

Для автоматической смены номера можно использовать скрипт:
```bash
#!/bin/bash
pm2 stop venom-bot
rm -rf /opt/venom-bot/tokens/ai-admin-session
pm2 start venom-bot
echo "Теперь отсканируйте QR код:"
pm2 logs venom-bot --lines 100
```