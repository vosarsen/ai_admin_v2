# Детальное описание MCP серверов для AI Admin v2

## 1. YClients MCP - Прямая работа с YClients API

### Что это такое?
YClients MCP - это локальный сервер, который дает мне (Claude) прямой доступ к YClients API без необходимости писать и запускать JavaScript код.

### Как это работает сейчас (БЕЗ MCP):
```javascript
// 1. Вы: "Проверь, какие слоты доступны завтра"
// 2. Я пишу скрипт:
const checkSlots = async () => {
  const response = await fetch('https://api.yclients.com/api/v1/book_times/962302/0/2024-07-20', {
    headers: {
      'Authorization': 'Bearer ...',
      'Accept': 'application/vnd.yclients.v2+json'
    }
  });
  console.log(await response.json());
};

// 3. Сохраняю в файл test-slots.js
// 4. Вы запускаете: node test-slots.js
// 5. Копируете результат обратно мне
// 6. Я анализирую...
```
**Время**: 3-5 минут

### Как будет работать С MCP:
```bash
# Вы: "Проверь, какие слоты доступны завтра"
# Я сразу выполняю:
@yclients get_available_slots company_id=962302 date="2024-07-20"

# Результат приходит мгновенно:
{
  "slots": [
    {"time": "10:00", "staff": ["Сергей", "Богдан"]},
    {"time": "11:30", "staff": ["Рауф"]},
    {"time": "14:00", "staff": ["Сергей", "Никита"]}
  ]
}
```
**Время**: 5 секунд

### Конкретные команды YClients MCP:

#### 1. Проверка доступных слотов
```bash
@yclients get_available_slots company_id=962302 service_id=15031280 date="2024-07-20"
# Показывает все свободные окна для услуги "Стрижка" на 20 июля
```

#### 2. Получение информации об услугах
```bash
@yclients get_services company_id=962302
# Возвращает все активные услуги с ценами и длительностью
```

#### 3. Создание тестовой записи
```bash
@yclients create_test_booking company_id=962302 phone="79001234567" service_id=15031280 datetime="2024-07-20T15:00:00"
# Создает запись и сразу показывает результат
```

#### 4. Проверка записи
```bash
@yclients get_booking company_id=962302 booking_id=12345
# Показывает детали записи
```

#### 5. Отмена записи
```bash
@yclients cancel_booking company_id=962302 booking_id=12345
# Отменяет запись
```

### Реальный пример использования:
```
Вы: "Почему клиент не может записаться на завтра в 15:00?"

Я делаю:
1. @yclients get_available_slots company_id=962302 date="2024-07-20" time="15:00"
   Результат: Слот занят

2. @yclients get_bookings_at_time company_id=962302 datetime="2024-07-20T15:00:00"
   Результат: Есть запись клиента Иванова на это время

3. @yclients get_staff_schedule company_id=962302 staff_id=2895125 date="2024-07-20"
   Результат: Мастер работает с 10:00 до 18:00

Ответ: "Время 15:00 уже занято другим клиентом. Ближайшие свободные слоты: 14:00 и 16:30"
```

---

## 2. WhatsApp Test MCP - Автоматическое тестирование

### Что это такое?
WhatsApp Test MCP позволяет мне отправлять тестовые сообщения в вашего WhatsApp бота и получать ответы, не выходя из Claude.

### Как это работает сейчас (БЕЗ MCP):
```
1. Вы: "Протестируй, как бот отвечает на 'Хочу записаться'"
2. Я: "Отправьте это сообщение боту в WhatsApp"
3. Вы: Открываете WhatsApp, отправляете сообщение
4. Вы: Ждете ответ, делаете скриншот
5. Вы: Загружаете скриншот в Claude
6. Я: Анализирую ответ...
```
**Время**: 2-3 минуты на каждый тест

### Как будет работать С MCP:
```bash
# Вы: "Протестируй, как бот отвечает на 'Хочу записаться'"
# Я сразу:
@whatsapp send_message phone="79001234567" message="Хочу записаться"

# Через 2 секунды:
@whatsapp get_response phone="79001234567"
# Результат:
{
  "response": "Отлично! На какую услугу вы хотели бы записаться?\n1. Стрижка\n2. Моделирование бороды\n3. Уход за кожей",
  "time": "2024-07-20T10:15:32",
  "status": "delivered"
}
```
**Время**: 5 секунд

### Конкретные команды WhatsApp Test MCP:

#### 1. Отправка сообщения
```bash
@whatsapp send_message phone="79001234567" message="Привет"
# Отправляет сообщение от тестового номера
```

#### 2. Получение последнего ответа
```bash
@whatsapp get_last_response phone="79001234567"
# Показывает последний ответ бота этому номеру
```

#### 3. Полный диалог
```bash
@whatsapp get_conversation phone="79001234567" last_messages=10
# Показывает последние 10 сообщений диалога
```

#### 4. Симуляция сценария
```bash
@whatsapp run_scenario scenario="booking_flow" phone="79001234567"
# Автоматически проходит весь флоу записи:
# - Привет
# - Хочу записаться
# - Выбираю стрижку
# - Завтра в 15:00
# - Подтверждаю
```

#### 5. Очистка тестовых данных
```bash
@whatsapp clear_test_data phone="79001234567"
# Удаляет все тестовые сообщения и записи
```

### Реальный пример использования:
```
Вы: "Протестируй весь процесс записи на стрижку"

Я делаю:
1. @whatsapp send_message phone="79001234567" message="Привет"
   Ответ: "Здравствуйте! Я AI ассистент..."

2. @whatsapp send_message phone="79001234567" message="Хочу записаться на стрижку"
   Ответ: "Отлично! Когда вам удобно?"

3. @whatsapp send_message phone="79001234567" message="Завтра в 15:00"
   Ответ: "Проверяю доступность... Есть свободное время! Записать вас?"

4. @whatsapp send_message phone="79001234567" message="Да"
   Ответ: "✅ Вы записаны на стрижку завтра в 15:00"

Результат: Весь флоу работает корректно, запись создана
```

---

## 3. Redis Context MCP - Управление контекстом диалогов

### Что это такое?
Redis Context MCP дает мне прямой доступ к Redis, где хранится вся информация о текущих диалогах пользователей.

### Как это работает сейчас (БЕЗ MCP):
```javascript
// 1. Вы: "Что бот помнит о пользователе 79001234567?"
// 2. Я пишу скрипт для проверки Redis
// 3. Вы запускаете скрипт на сервере
// 4. Копируете результат
// 5. Я анализирую...
```
**Проблемы**: 
- Долго
- Нужен доступ к серверу
- Сложно менять контекст для тестов

### Как будет работать С MCP:
```bash
# Вы: "Что бот помнит о пользователе 79001234567?"
# Я сразу:
@redis get_context phone="79001234567" company_id=962302

# Результат:
{
  "client": {
    "name": "Иван",
    "lastVisit": "2024-07-15",
    "favoriteService": "Стрижка"
  },
  "conversation": [
    {"role": "user", "content": "Привет"},
    {"role": "assistant", "content": "Здравствуйте, Иван!"},
    {"role": "user", "content": "Хочу записаться"}
  ],
  "currentBooking": {
    "stage": "selecting_time",
    "service": "Стрижка",
    "date": "2024-07-20"
  }
}
```

### Конкретные команды Redis Context MCP:

#### 1. Получить контекст
```bash
@redis get_context phone="79001234567"
# Показывает всю информацию о диалоге
```

#### 2. Очистить контекст (для тестов)
```bash
@redis clear_context phone="79001234567"
# Сбрасывает диалог - бот забывает пользователя
```

#### 3. Установить конкретное состояние
```bash
@redis set_booking_stage phone="79001234567" stage="selecting_service"
# Переводит диалог в нужную стадию для тестирования
```

#### 4. Посмотреть все активные диалоги
```bash
@redis list_active_contexts company_id=962302
# Показывает всех, кто сейчас общается с ботом
```

#### 5. Симулировать постоянного клиента
```bash
@redis set_client_history phone="79001234567" visits=10 last_services=["Стрижка", "Борода"]
# Делает из нового клиента постоянного для тестов
```

### Реальный пример использования:
```
Вы: "Почему бот не предлагает клиенту его любимую услугу?"

Я делаю:
1. @redis get_context phone="79001234567"
   Вижу: контекст пустой, бот не знает историю клиента

2. @supabase query_table table="clients" filters={"phone": "79001234567"}
   Вижу: клиент есть в базе, 5 визитов, всегда стрижка

3. @logs logs_search pattern="loadClient.*79001234567"
   Вижу ошибку: "Client loading failed: connection timeout"

Проблема: Таймаут при загрузке данных клиента из Supabase
Решение: Нужно добавить retry и увеличить таймаут
```

---

## 🎯 Как это все работает вместе

### Сценарий: Полная отладка проблемы с записью

```bash
# 1. Пользователь жалуется, что не может записаться
Вы: "Клиент 79001234567 говорит, что бот не дает записаться на завтра"

# 2. Проверяю контекст диалога
@redis get_context phone="79001234567"
# Вижу: диалог застрял на выборе времени

# 3. Проверяю доступные слоты
@yclients get_available_slots company_id=962302 date="2024-07-20"
# Вижу: слоты есть

# 4. Воспроизвожу проблему
@whatsapp send_message phone="79001234567" message="15:00"
@whatsapp get_last_response phone="79001234567"
# Вижу: бот отвечает "Произошла ошибка"

# 5. Смотрю логи
@logs logs_tail lines=50
# Вижу: "TypeError: Cannot read property 'staff_id' of undefined"

# 6. Проверяю данные
@supabase query_table table="staff_schedules" filters={"date": "2024-07-20"}
# Вижу: нет расписания на завтра

Проблема найдена: Не загружено расписание мастеров на завтра
```

**Время на всю отладку**: 1 минута вместо 15-20 минут

## 💡 Главное преимущество

Все эти MCP серверы превращают меня из "помощника, который пишет код" в "активного участника разработки", который может:
- Сам проверять гипотезы
- Быстро находить проблемы
- Тестировать решения
- Не отвлекать вас на рутину

Это как дать мне прямой доступ к инструментам разработчика вместо того, чтобы просить вас нажимать кнопки за меня.