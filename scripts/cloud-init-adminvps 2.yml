#!/bin/bash
#cloud-config
# AdminVPS Cloud-Init Configuration
# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð° Ð´Ð»Ñ AI Admin v2
#
# Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐÐ˜Ð•:
# 1. ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð½Ð° AdminVPS Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÑ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð² Ð¿Ð¾Ð»Ðµ "Cloud-init"
# 2. ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð² ÑÐµÐºÑ†Ð¸Ð¸ "CONFIGURATION" Ð½Ð¸Ð¶Ðµ
# 3. ÐŸÐ¾ÑÐ»Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ 5-10 Ð¼Ð¸Ð½ÑƒÑ‚ Ð´Ð»Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸
# 4. SSH Ð² ÑÐµÑ€Ð²ÐµÑ€: ssh root@YOUR_SERVER_IP
# 5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ: cat /var/log/cloud-init-output.log
#
# Ð’ÐÐ–ÐÐž: Ð­Ñ‚Ð¾Ñ‚ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÑ‚ Ubuntu 22.04 LTS

# ============================================================================
# CONFIGURATION - Ð—ÐÐœÐ•ÐÐ˜Ð¢Ð• Ð­Ð¢Ð˜ Ð—ÐÐÐ§Ð•ÐÐ˜Ð¯ ÐŸÐ•Ð Ð•Ð” Ð˜Ð¡ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐÐ˜Ð•Ðœ!
# ============================================================================

# GitHub Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ (ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹)
GITHUB_REPO="https://github.com/YOUR_USERNAME/ai_admin_v2.git"
GITHUB_TOKEN="YOUR_GITHUB_TOKEN"  # Personal Access Token Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¿Ð¾

# SSH ÐºÐ»ÑŽÑ‡Ð¸ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° (ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ²Ð¾Ð¹ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡)
SSH_PUBLIC_KEY="ssh-ed25519 AAAAC3... your-key-comment"

# Ð”Ð¾Ð¼ÐµÐ½ Ð´Ð»Ñ SSL (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼)
DOMAIN=""  # ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: bot.yourdomain.com

# Telegram Ð´Ð»Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
TELEGRAM_BOT_TOKEN=""
TELEGRAM_CHAT_ID=""

# ============================================================================
# CLOUD-INIT SCRIPT - ÐÐ• Ð Ð•Ð”ÐÐšÐ¢Ð˜Ð Ð£Ð™Ð¢Ð• ÐÐ˜Ð–Ð• Ð­Ð¢ÐžÐ™ Ð›Ð˜ÐÐ˜Ð˜
# ============================================================================

set -e
exec > >(tee /var/log/cloud-init-custom.log)
exec 2>&1

echo "============================================"
echo "ðŸš€ AI Admin v2 - Cloud-Init Setup"
echo "============================================"
echo "Start time: $(date)"
echo ""

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð² Telegram
send_telegram() {
    if [ -n "$TELEGRAM_BOT_TOKEN" ] && [ -n "$TELEGRAM_CHAT_ID" ]; then
        curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="$1" \
            -d parse_mode="HTML" > /dev/null 2>&1 || true
    fi
}

send_telegram "ðŸš€ <b>AdminVPS Setup Started</b>%0AServer: $(hostname)%0AIP: $(hostname -I | awk '{print $1}')"

# 1. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
echo "ðŸ“¦ Step 1/10: Updating system packages..."
export DEBIAN_FRONTEND=noninteractive
apt-get update -y
apt-get upgrade -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold"

# 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
echo "ðŸ”§ Step 2/10: Installing base packages..."
apt-get install -y \
    curl \
    wget \
    git \
    nginx \
    certbot \
    python3-certbot-nginx \
    redis-server \
    build-essential \
    software-properties-common \
    ufw \
    htop \
    vim \
    net-tools \
    unzip

# 3. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Node.js 18.x
echo "ðŸ“— Step 3/10: Installing Node.js 18..."
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt-get install -y nodejs

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÐµÑ€ÑÐ¸Ð¸ Node.js
node --version
npm --version

# 4. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° PM2
echo "ðŸ”„ Step 4/10: Installing PM2..."
npm install -g pm2
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 100M
pm2 set pm2-logrotate:retain 20
pm2 set pm2-logrotate:compress true

# 5. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Redis
echo "ðŸ” Step 5/10: Configuring Redis..."
REDIS_PASSWORD=$(openssl rand -base64 32)

# Backup Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
cp /etc/redis/redis.conf /etc/redis/redis.conf.backup

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Redis Ð´Ð»Ñ production
cat >> /etc/redis/redis.conf << 'REDIS_EOF'

# AI Admin Production Settings
requirepass REDIS_PASSWORD_PLACEHOLDER
maxmemory 2gb
maxmemory-policy allkeys-lru
bind 127.0.0.1
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /var/lib/redis
REDIS_EOF

# Ð—Ð°Ð¼ÐµÐ½Ð° Ð¿Ð°Ñ€Ð¾Ð»Ñ
sed -i "s/REDIS_PASSWORD_PLACEHOLDER/$REDIS_PASSWORD/" /etc/redis/redis.conf

systemctl restart redis-server
systemctl enable redis-server

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ñ Redis
echo "$REDIS_PASSWORD" > /root/.redis_password
chmod 600 /root/.redis_password

echo "âœ… Redis configured with password saved to /root/.redis_password"

# 6. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹ Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
echo "ðŸ‘¤ Step 6/10: Creating directories and user..."

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ ai-admin (ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚)
if ! id -u ai-admin > /dev/null 2>&1; then
    useradd -r -m -s /bin/bash ai-admin
fi

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹
mkdir -p /opt/ai-admin
mkdir -p /backups/ai-admin
mkdir -p /var/log/ai-admin

chown -R ai-admin:ai-admin /opt/ai-admin
chown -R ai-admin:ai-admin /backups/ai-admin
chown -R ai-admin:ai-admin /var/log/ai-admin

# 7. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° SSH
echo "ðŸ”‘ Step 7/10: Configuring SSH..."

# Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ SSH ÐºÐ»ÑŽÑ‡Ð° Ð´Ð»Ñ root
mkdir -p /root/.ssh
chmod 700 /root/.ssh
echo "$SSH_PUBLIC_KEY" >> /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° SSH Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
sed -i 's/#PermitRootLogin yes/PermitRootLogin prohibit-password/' /etc/ssh/sshd_config
sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
systemctl restart sshd

echo "âœ… SSH configured (key-based auth only)"

# 8. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Firewall
echo "ðŸ”¥ Step 8/10: Configuring firewall..."
ufw --force reset
ufw default deny incoming
ufw default allow outgoing
ufw allow 22/tcp comment 'SSH'
ufw allow 80/tcp comment 'HTTP'
ufw allow 443/tcp comment 'HTTPS'
ufw --force enable

echo "âœ… Firewall configured"

# 9. ÐšÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ
echo "ðŸ“¦ Step 9/10: Cloning repository..."

if [ -n "$GITHUB_TOKEN" ] && [ "$GITHUB_REPO" != "https://github.com/YOUR_USERNAME/ai_admin_v2.git" ]; then
    # Ð—Ð°Ð¼ÐµÐ½Ð° URL Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ‚Ð¾ÐºÐµÐ½Ð°
    REPO_URL=$(echo $GITHUB_REPO | sed "s|https://|https://${GITHUB_TOKEN}@|")

    su - ai-admin -c "cd /opt/ai-admin && git clone $REPO_URL ."

    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° git Ð´Ð»Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ credentials
    su - ai-admin -c "cd /opt/ai-admin && git config credential.helper store"

    echo "âœ… Repository cloned"
else
    echo "âš ï¸  GITHUB_REPO or GITHUB_TOKEN not configured - skipping git clone"
    echo "   You need to manually clone the repository later"
fi

# 10. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
echo "ðŸ“š Step 10/10: Installing dependencies..."

if [ -d "/opt/ai-admin/package.json" ]; then
    su - ai-admin -c "cd /opt/ai-admin && npm install --production"
    echo "âœ… Dependencies installed"
else
    echo "âš ï¸  package.json not found - skip npm install"
fi

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ swap Ñ„Ð°Ð¹Ð»Ð° (2GB)
echo "ðŸ’¾ Creating swap file..."
if [ ! -f /swapfile ]; then
    fallocate -l 2G /swapfile
    chmod 600 /swapfile
    mkswap /swapfile
    swapon /swapfile
    echo '/swapfile none swap sw 0 0' >> /etc/fstab
    echo "âœ… Swap file created (2GB)"
fi

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Nginx
echo "ðŸŒ Creating Nginx configuration..."

cat > /etc/nginx/sites-available/ai-admin << 'NGINX_EOF'
server {
    listen 80;
    server_name _;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;

        # Timeouts Ð´Ð»Ñ Ð´Ð¾Ð»Ð³Ð¸Ñ… AI Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Health check endpoint
    location /health {
        proxy_pass http://localhost:3000/health;
        access_log off;
    }
}
NGINX_EOF

ln -sf /etc/nginx/sites-available/ai-admin /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default

nginx -t && systemctl restart nginx
systemctl enable nginx

echo "âœ… Nginx configured"

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
echo "ðŸ”’ Configuring automatic security updates..."
apt-get install -y unattended-upgrades
dpkg-reconfigure -plow unattended-upgrades

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð´Ð»Ñ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾Ð³Ð¾ Ð±ÑÐºÐ°Ð¿Ð°
cat > /opt/ai-admin/backup.sh << 'BACKUP_EOF'
#!/bin/bash
# Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð±ÑÐºÐ°Ð¿

BACKUP_DIR="/backups/ai-admin"
DATE=$(date +%Y%m%d_%H%M%S)

# Ð‘ÑÐºÐ°Ð¿ Redis
redis-cli --pass $(cat /root/.redis_password) SAVE
cp /var/lib/redis/dump.rdb "$BACKUP_DIR/redis_$DATE.rdb"

# Ð‘ÑÐºÐ°Ð¿ Baileys sessions
tar -czf "$BACKUP_DIR/baileys_sessions_$DATE.tar.gz" /opt/ai-admin/baileys_sessions/ 2>/dev/null || true

# Ð‘ÑÐºÐ°Ð¿ .env Ñ„Ð°Ð¹Ð»Ð¾Ð²
tar -czf "$BACKUP_DIR/env_$DATE.tar.gz" /opt/ai-admin/.env* 2>/dev/null || true

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð±ÑÐºÐ°Ð¿Ð¾Ð² (ÑÑ‚Ð°Ñ€ÑˆÐµ 7 Ð´Ð½ÐµÐ¹)
find "$BACKUP_DIR" -name "*.rdb" -mtime +7 -delete
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
BACKUP_EOF

chmod +x /opt/ai-admin/backup.sh

# Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² cron (ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾ Ð² 3:00)
(crontab -l 2>/dev/null; echo "0 3 * * * /opt/ai-admin/backup.sh >> /var/log/ai-admin/backup.log 2>&1") | crontab -

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ README Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼Ð¸
cat > /root/SETUP_COMPLETE.txt << 'README_EOF'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ðŸŽ‰ AI Admin v2 Setup Complete!                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“‹ INSTALLATION SUMMARY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… System packages updated
âœ… Node.js 18.x installed
âœ… PM2 installed with log rotation
âœ… Redis installed and configured
âœ… Nginx installed and configured
âœ… Firewall (UFW) configured
âœ… SSH hardened (key-based auth only)
âœ… Swap file created (2GB)
âœ… Automatic security updates enabled
âœ… Daily backup script configured

ðŸ” IMPORTANT CREDENTIALS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Redis Password: See /root/.redis_password

ðŸ“‚ DIRECTORY STRUCTURE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

/opt/ai-admin/          - Application directory
/backups/ai-admin/      - Daily backups
/var/log/ai-admin/      - Application logs

ðŸ“ NEXT STEPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Configure environment variables:

   cd /opt/ai-admin
   cp .env.production .env

   Edit .env and set:
   - REDIS_PASSWORD (from /root/.redis_password)
   - Update API_BASE_URL to your server IP
   - Update WEBHOOK_URL to your server IP

2. Build TypeScript:

   npm run build

3. Start services with PM2:

   pm2 start ecosystem.config.js
   pm2 save
   pm2 startup

4. Check PM2 status:

   pm2 status
   pm2 logs

5. (Optional) Configure SSL with Let's Encrypt:

   certbot --nginx -d your-domain.com

   Or update Nginx config to use your domain

6. Test the API:

   curl http://localhost:3000/health

ðŸ“Š MONITORING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# PM2 Status
pm2 status

# View logs
pm2 logs

# Monitor resources
pm2 monit

# Redis status
redis-cli -a $(cat /root/.redis_password) INFO

# Nginx status
systemctl status nginx

# Check disk space
df -h

ðŸ”§ USEFUL COMMANDS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Restart all services
pm2 restart all

# Pull latest code
cd /opt/ai-admin && git pull && npm run build && pm2 restart all

# Manual backup
/opt/ai-admin/backup.sh

# View backup logs
tail -f /var/log/ai-admin/backup.log

ðŸ“š DOCUMENTATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

See /opt/ai-admin/docs/ for detailed documentation:
- ARCHITECTURE.md
- MCP_SERVERS_GUIDE.md
- TROUBLESHOOTING.md
- CLAUDE.md (Quick reference)

ðŸ†˜ TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

If services don't start:
1. Check logs: pm2 logs --err
2. Check Redis: redis-cli -a $(cat /root/.redis_password) PING
3. Check Nginx: nginx -t
4. Check firewall: ufw status

Common issues:
- "Redis connection failed" â†’ Check Redis password in .env
- "Port 3000 in use" â†’ pm2 restart all
- "WhatsApp session error" â†’ Delete baileys_sessions/ and reconnect

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

For support, check:
- /opt/ai-admin/docs/TROUBLESHOOTING.md
- Cloud-init logs: /var/log/cloud-init-output.log
- Custom setup log: /var/log/cloud-init-custom.log

Good luck! ðŸš€
README_EOF

# Ð’Ñ‹Ð²Ð¾Ð´ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
echo ""
echo "============================================"
echo "âœ… AI Admin v2 Setup Complete!"
echo "============================================"
echo ""
echo "ðŸ“‹ Next steps saved to: /root/SETUP_COMPLETE.txt"
echo ""
echo "ðŸ” Redis password saved to: /root/.redis_password"
echo ""
echo "ðŸ“ Application directory: /opt/ai-admin"
echo ""
echo "To continue setup:"
echo "  cat /root/SETUP_COMPLETE.txt"
echo ""
echo "Setup completed at: $(date)"

# ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ð± ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ
REDIS_PASS=$(cat /root/.redis_password)
SERVER_IP=$(hostname -I | awk '{print $1}')

send_telegram "âœ… <b>AdminVPS Setup Complete!</b>%0A%0AServer IP: ${SERVER_IP}%0ARedis Password: ${REDIS_PASS}%0A%0ANext: Configure .env and start PM2"

echo ""
echo "ðŸŽ‰ All done! Server is ready for AI Admin v2"
echo ""
