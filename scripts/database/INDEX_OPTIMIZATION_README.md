# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö AI Admin v2

## üéØ –¶–µ–ª—å
–£—Å–∫–æ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É AI Admin v2 –ø—É—Ç–µ–º —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

## üìä –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
1. **–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É** - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
2. **–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥ –∫–æ–º–ø–∞–Ω–∏–∏** - –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏** - –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è** - –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
5. **–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞** - –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

### 1. –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Supabase
psql postgresql://postgres:[password]@db.[project].supabase.co:5432/postgres

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞–Ω–∞–ª–∏–∑
\i analyze-indexes.sql
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
\i create-indexes.sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard:
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
# 2. –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ create-indexes.sql
# 3. –ù–∞–∂–º–∏—Ç–µ Run
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –î–û –∏–Ω–¥–µ–∫—Å–æ–≤
EXPLAIN (ANALYZE, BUFFERS) 
SELECT * FROM services 
WHERE company_id = 123 AND is_active = true;

-- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã...

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ü–û–°–õ–ï –∏–Ω–¥–µ–∫—Å–æ–≤
EXPLAIN (ANALYZE, BUFFERS) 
SELECT * FROM services 
WHERE company_id = 123 AND is_active = true;
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ó–∞–ø—Ä–æ—Å—ã —É—Å–ª—É–≥
- **–î–æ**: ~100-500ms –ø—Ä–∏ 50,000 –∑–∞–ø–∏—Å–µ–π
- **–ü–æ—Å–ª–µ**: ~5-10ms
- **–£–ª—É—á—à–µ–Ω–∏–µ**: 10-100x

### –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- **–î–æ**: ~50-200ms –ø—Ä–∏ 100,000 –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–ü–æ—Å–ª–µ**: ~1-5ms
- **–£–ª—É—á—à–µ–Ω–∏–µ**: 50-200x

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- **–î–æ**: ~200-800ms –¥–ª—è –Ω–µ–¥–µ–ª–∏
- **–ü–æ—Å–ª–µ**: ~10-20ms
- **–£–ª—É—á—à–µ–Ω–∏–µ**: 20-80x

## üîß –ò–Ω–¥–µ–∫—Å—ã –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
1. `idx_services_company_active` - —É—Å–ª—É–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏
2. `idx_staff_company_active` - –º–∞—Å—Ç–µ—Ä–∞ –∫–æ–º–ø–∞–Ω–∏–∏
3. `idx_staff_schedules_lookup` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–æ–≤
4. `idx_clients_phone_company` - –ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
5. `idx_dialog_contexts_user` - –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—É–ª—É—á—à–∞—é—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É)
6. `idx_appointments_client_history` - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π
7. `idx_clients_visit_count` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–∏–∑–∏—Ç–∞–º

## üõ†Ô∏è –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
```sql
-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
ANALYZE services, staff, staff_schedules, clients;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT indexrelname, idx_scan, idx_tup_read 
FROM pg_stat_user_indexes 
WHERE schemaname = 'public' 
ORDER BY idx_scan;
```

### –ï–∂–µ–º–µ—Å—è—á–Ω–æ
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å bloat (—Ä–∞–∑–¥—É—Ç–∏–µ)
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å analyze-indexes.sql —Ä–∞–∑–¥–µ–ª 6

-- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥—É—Ç—ã–µ –∏–Ω–¥–µ–∫—Å—ã
REINDEX CONCURRENTLY INDEX idx_name;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **CONCURRENTLY** - —Å–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü
2. **Partial –∏–Ω–¥–µ–∫—Å—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è WHERE —É—Å–ª–æ–≤–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
3. **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** - –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤–∞–∂–µ–Ω!
4. **Monitoring** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ pg_stat_user_indexes

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ò–Ω–¥–µ–∫—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ EXPLAIN ANALYZE
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: `ANALYZE table_name;`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CONCURRENTLY
2. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –≤ –ø–µ—Ä–∏–æ–¥ –Ω–∏–∑–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
3. –£–≤–µ–ª–∏—á—å—Ç–µ maintenance_work_mem

### Out of memory
```sql
-- –í—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å –¥–ª—è —Å–µ—Å—Å–∏–∏
SET maintenance_work_mem = '1GB';
CREATE INDEX ...;
RESET maintenance_work_mem;
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Supabase –∏–ª–∏ PostgreSQL.