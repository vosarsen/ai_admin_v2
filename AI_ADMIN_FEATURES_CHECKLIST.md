# AI Admin v2 - Чек-лист функциональности

## Порядок реализации и тестирования

### Фаза 1: Базовая функциональность (критическая)

#### 1. ✅ Базовое понимание текста и определение намерений
**Описание**: AI должен корректно понимать, что хочет пользователь
**Функции**:
- Распознавание интента: запись, отмена, перенос, информация
- Понимание синонимов и разговорной речи
- Обработка опечаток и сокращений
- Определение временных указаний (завтра, в пятницу, через неделю)

**Тесты**:
- "хочу записаться" → интент: запись
- "нужно отменить запись" → интент: отмена
- "свободно завтра?" → интент: проверка слотов + дата
- "скок стоит стрижка" → интент: цены (с опечаткой)

---

#### 2. ✅ Автоматическое определение типа бизнеса
**Описание**: Система должна адаптировать терминологию под тип салона
**Функции**:
- Определение типа по настройкам компании
- Адаптация терминов (барбер/мастер, стрижка/маникюр)
- Правильные приветствия для каждого типа
- Соответствующий стиль общения

**Тесты**:
- Барбершоп: "барбер", "стрижка", мужской стиль
- Ногтевая студия: "мастер", "маникюр", женский стиль
- Массажный салон: "специалист", "сеанс", нейтральный стиль

---

#### 3. ✅ Поиск свободных слотов [SEARCH_SLOTS]
**Описание**: Корректный поиск и отображение доступного времени
**Функции**:
- Поиск по дате/времени
- Фильтрация по услуге
- Фильтрация по мастеру
- Группировка по дням
- Учет рабочего времени

**Тесты**:
- "когда можно записаться?" → все слоты на ближайшие дни
- "свободно завтра к Ивану?" → слоты конкретного мастера
- "есть время на стрижку в субботу?" → фильтр по услуге и дате
- "можно вечером?" → фильтр по времени (после 18:00)

---

#### 4. ✅ Создание записи [CREATE_BOOKING]
**Описание**: Полный процесс создания записи с валидацией
**Функции**:
- Сбор всех необходимых данных (услуга, мастер, время)
- Проверка доступности слота
- Создание записи в YClients
- Подтверждение клиенту
- Сохранение в базе данных

**Тесты**:
- Полная запись: услуга + мастер + время
- Запись только с услугой (любой мастер)
- Запись с уточнением недостающих данных
- Отказ при занятом слоте

---

### Фаза 2: Расширенная функциональность

#### 5. ✅ Показ прайс-листа [SHOW_PRICES]
**Описание**: Отображение актуальных цен на услуги
**Функции**:
- Загрузка цен из YClients
- Группировка по категориям
- Форматирование для WhatsApp
- Поиск конкретной услуги

**Тесты**:
- "сколько стоит?" → полный прайс
- "цена на стрижку" → конкретная услуга
- "что есть до 1000 рублей?" → фильтр по цене

---

#### 6. ✅ Показ портфолио [SHOW_PORTFOLIO]
**Описание**: Демонстрация работ мастеров
**Функции**:
- Загрузка фото из YClients
- Отправка медиа в WhatsApp
- Портфолио конкретного мастера
- Примеры по типу услуги

**Тесты**:
- "покажи работы" → общее портфолио
- "фото работ Марии" → портфолио мастера
- "примеры окрашивания" → фильтр по услуге

---

#### 7. ✅ Отмена записи
**Описание**: Отмена существующих записей клиента
**Функции**:
- Поиск активных записей клиента
- Подтверждение отмены
- Удаление из YClients
- Уведомление об отмене

**Тесты**:
- Отмена единственной записи
- Выбор из нескольких записей
- Отмена по дате/времени
- Отказ от отмены

---

#### 8. ✅ Перенос записи
**Описание**: Изменение времени существующей записи
**Функции**:
- Поиск текущей записи
- Выбор нового времени
- Проверка доступности
- Обновление в YClients

**Тесты**:
- Перенос на конкретное время
- Перенос на другой день
- Перенос к другому мастеру
- Отказ при занятости

---

#### 9. ✅ Проверка своих записей
**Описание**: Просмотр активных записей клиента
**Функции**:
- Поиск по номеру телефона
- Отображение деталей записи
- Напоминание о времени
- История прошлых визитов

**Тесты**:
- "мои записи" → список активных
- "когда я записан?" → ближайшая запись
- "история визитов" → прошлые записи

---

### Фаза 3: Продвинутые функции

#### 10. ✅ Напоминания
**Описание**: Автоматические напоминания о записи
**Функции**:
- Напоминание за день (вечером 19:00 - 21:00)
- Напоминание за 2 часа
- Кастомизация текста
- Отслеживание отправки

**Тесты**:
- Отправка за 24 часа
- Отправка за 2 часа
- Не дублировать напоминания
- Учет часового пояса

---

#### 11. ✅ Контекст разговора
**Описание**: Память о предыдущих сообщениях
**Функции**:
- Сохранение контекста на 30 дней
- Запоминание предпочтений
- Продолжение прерванного диалога
- Очистка старого контекста

**Тесты**:
- Продолжение записи после паузы
- Запоминание любимого мастера
- Учет предыдущих отказов
- Сброс после 30 дней

---

#### 12. ✅ Rapid-fire защита
**Описание**: Игнорирование дублирующихся сообщений
**Функции**:
- Детекция повторов за 3 секунды
- Обработка только первого
- Логирование дублей
- Умная фильтрация

**Тесты**:
- 5 одинаковых сообщений → 1 ответ
- Разные сообщения → все обработаны
- Повтор через 5 секунд → обработан

---

#### 13. ✅ Обработка ошибок
**Описание**: Graceful degradation при сбоях
**Функции**:
- Fallback при недоступности YClients
- Обработка таймаутов AI
- Понятные сообщения об ошибках
- Автоматические повторы

**Тесты**:
- Недоступен YClients → сообщение
- Таймаут AI → повтор
- Неверные данные → валидация
- Сетевая ошибка → retry

---

### Фаза 4: Дополнительные функции

#### 14. ✅ Мультиязычность
**Описание**: Поддержка нескольких языков
**Функции**:
- Автоопределение языка
- Переключение языка
- Локализация всех сообщений
- Сохранение предпочтения

**Тесты**:
- "Hello" → ответ на английском
- "Привет" → ответ на русском
- Смешанный текст → основной язык

---

#### 15. ✅ Аналитика
**Описание**: Сбор статистики использования
**Функции**:
- Количество сообщений
- Популярные интенты
- Конверсия в записи
- Время ответа

**Тесты**:
- Счетчики в базе данных
- Дашборд статистики
- Экспорт данных
- Real-time метрики

## Критерии успеха для каждой фичи

### Оценка 10/10 включает:
1. ✅ Функция работает в 100% тестовых случаев
2. ✅ Время ответа < 3 секунд
3. ✅ Обработка всех edge cases
4. ✅ Понятные сообщения пользователю
5. ✅ Логирование для отладки
6. ✅ Graceful degradation при ошибках
7. ✅ Покрытие unit тестами
8. ✅ Интеграционные тесты
9. ✅ Документация функции
10. ✅ Метрики производительности

## Текущий статус

- [ ] Фаза 1: В процессе
- [ ] Фаза 2: Ожидает
- [ ] Фаза 3: Ожидает
- [ ] Фаза 4: Ожидает

Начинаем с первой фичи и движемся последовательно!